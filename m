Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id 93EB24DE59D
	for <lists+openrisc@lfdr.de>; Sat, 19 Mar 2022 04:55:26 +0100 (CET)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 779C424815;
	Sat, 19 Mar 2022 04:55:26 +0100 (CET)
Received: from ams.source.kernel.org (ams.source.kernel.org [145.40.68.75])
 by mail.librecores.org (Postfix) with ESMTPS id 484AF24807
 for <openrisc@lists.librecores.org>; Sat, 19 Mar 2022 04:55:25 +0100 (CET)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by ams.source.kernel.org (Postfix) with ESMTPS id B6FBEB82603;
 Sat, 19 Mar 2022 03:55:24 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 63DDBC340EE;
 Sat, 19 Mar 2022 03:55:20 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1647662123;
 bh=94ul4sY+mwnjxOkYK9GbTixjNIKfz+vE6/QiryjPo4c=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=q2AB8rAS9FMDRAKWlccqOMMxPVlXmvcDzD8ZQvNl2qU3FIrQpwYECanOe2OTLNB8Q
 cc/1wkpKde8lCMA5ZvLVwB50z+idgJI8VH4mz7mDLI8axirL1HiP//dVBObu7sbRtV
 UQPmZD+4lbRWlksZTeCH2MjJZeN5DRlRN7YRKHbrvxbC+zEdb5BMj5OPIstHztTdQv
 d2/A4s2vduhgSPrU32IpecvVX0wZVYI9BoZaY0mEL5vIJjRifNq5Qmbb73YVz4EJjC
 AOCtiotdpOGbZF0Vl8FpmOcEp7k/4+TJJXPVHVhEw2JZ3xjK6Iyemp1+2MNnQs41NI
 SfPaEkk8tprcw==
From: guoren@kernel.org
To: guoren@kernel.org, palmer@dabbelt.com, arnd@arndb.de, boqun.feng@gmail.com,
 longman@redhat.com, peterz@infradead.org
Date: Sat, 19 Mar 2022 11:54:55 +0800
Message-Id: <20220319035457.2214979-4-guoren@kernel.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220319035457.2214979-1-guoren@kernel.org>
References: <20220319035457.2214979-1-guoren@kernel.org>
MIME-Version: 1.0
Subject: [OpenRISC] [PATCH V2 3/5] csky: Move to generic ticket-spinlock
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: linux-arch@vger.kernel.org, Guo Ren <guoren@linux.alibaba.com>,
 linux-kernel@vger.kernel.org, linux-csky@vger.kernel.org,
 openrisc@lists.librecores.org, Palmer Dabbelt <palmer@rivosinc.com>,
 linux-riscv@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

RnJvbTogR3VvIFJlbiA8Z3VvcmVuQGxpbnV4LmFsaWJhYmEuY29tPgoKVGhlcmUgaXMgbm8gYmVu
ZWZpdCBmcm9tIGN1c3RvbSBpbXBsZW1lbnRhdGlvbiBmb3IgdGlja2V0LXNwaW5sb2NrLApzbyBt
b3ZlIHRvIGdlbmVyaWMgdGlja2V0LXNwaW5sb2NrIGZvciBlYXN5IG1haW50ZW5hbmNlLgoKU2ln
bmVkLW9mZi1ieTogR3VvIFJlbiA8Z3VvcmVuQGxpbnV4LmFsaWJhYmEuY29tPgpDYzogUGFsbWVy
IERhYmJlbHQgPHBhbG1lckByaXZvc2luYy5jb20+Ci0tLQogYXJjaC9jc2t5L2luY2x1ZGUvYXNt
L0tidWlsZCAgICAgICAgICAgfCAgMyArLQogYXJjaC9jc2t5L2luY2x1ZGUvYXNtL3NwaW5sb2Nr
LmggICAgICAgfCA4OSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogYXJjaC9jc2t5L2luY2x1
ZGUvYXNtL3NwaW5sb2NrX3R5cGVzLmggfCAyNyAtLS0tLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAy
IGluc2VydGlvbnMoKyksIDExNyBkZWxldGlvbnMoLSkKIGRlbGV0ZSBtb2RlIDEwMDY0NCBhcmNo
L2Nza3kvaW5jbHVkZS9hc20vc3BpbmxvY2suaAogZGVsZXRlIG1vZGUgMTAwNjQ0IGFyY2gvY3Nr
eS9pbmNsdWRlL2FzbS9zcGlubG9ja190eXBlcy5oCgpkaWZmIC0tZ2l0IGEvYXJjaC9jc2t5L2lu
Y2x1ZGUvYXNtL0tidWlsZCBiL2FyY2gvY3NreS9pbmNsdWRlL2FzbS9LYnVpbGQKaW5kZXggOTA0
YTE4YTgxOGJlLi4wNTY2MjU2MTljMTkgMTAwNjQ0Ci0tLSBhL2FyY2gvY3NreS9pbmNsdWRlL2Fz
bS9LYnVpbGQKKysrIGIvYXJjaC9jc2t5L2luY2x1ZGUvYXNtL0tidWlsZApAQCAtMyw2ICszLDcg
QEAgZ2VuZXJpYy15ICs9IGFzbS1vZmZzZXRzLmgKIGdlbmVyaWMteSArPSBleHRhYmxlLmgKIGdl
bmVyaWMteSArPSBncGlvLmgKIGdlbmVyaWMteSArPSBrdm1fcGFyYS5oCi1nZW5lcmljLXkgKz0g
cXJ3bG9jay5oCitnZW5lcmljLXkgKz0gc3BpbmxvY2tfdHlwZXMuaAorZ2VuZXJpYy15ICs9IHNw
aW5sb2NrLmgKIGdlbmVyaWMteSArPSB1c2VyLmgKIGdlbmVyaWMteSArPSB2bWxpbnV4Lmxkcy5o
CmRpZmYgLS1naXQgYS9hcmNoL2Nza3kvaW5jbHVkZS9hc20vc3BpbmxvY2suaCBiL2FyY2gvY3Nr
eS9pbmNsdWRlL2FzbS9zcGlubG9jay5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCA2
OWY1YWEyNDljNWYuLjAwMDAwMDAwMDAwMAotLS0gYS9hcmNoL2Nza3kvaW5jbHVkZS9hc20vc3Bp
bmxvY2suaAorKysgL2Rldi9udWxsCkBAIC0xLDg5ICswLDAgQEAKLS8qIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wICovCi0KLSNpZm5kZWYgX19BU01fQ1NLWV9TUElOTE9DS19ICi0j
ZGVmaW5lIF9fQVNNX0NTS1lfU1BJTkxPQ0tfSAotCi0jaW5jbHVkZSA8bGludXgvc3BpbmxvY2tf
dHlwZXMuaD4KLSNpbmNsdWRlIDxhc20vYmFycmllci5oPgotCi0vKgotICogVGlja2V0LWJhc2Vk
IHNwaW4tbG9ja2luZy4KLSAqLwotc3RhdGljIGlubGluZSB2b2lkIGFyY2hfc3Bpbl9sb2NrKGFy
Y2hfc3BpbmxvY2tfdCAqbG9jaykKLXsKLQlhcmNoX3NwaW5sb2NrX3QgbG9ja3ZhbDsKLQl1MzIg
dGlja2V0X25leHQgPSAxIDw8IFRJQ0tFVF9ORVhUOwotCXUzMiAqcCA9ICZsb2NrLT5sb2NrOwot
CXUzMiB0bXA7Ci0KLQlhc20gdm9sYXRpbGUgKAotCQkiMToJbGRleC53CQklMCwgKCUyKSBcbiIK
LQkJIgltb3YJCSUxLCAlMAkgXG4iCi0JCSIJYWRkCQklMCwgJTMJIFxuIgotCQkiCXN0ZXgudwkJ
JTAsICglMikgXG4iCi0JCSIJYmV6CQklMCwgMWIgICBcbiIKLQkJOiAiPSZyIiAodG1wKSwgIj0m
ciIgKGxvY2t2YWwpCi0JCTogInIiKHApLCAiciIodGlja2V0X25leHQpCi0JCTogImNjIik7Ci0K
LQl3aGlsZSAobG9ja3ZhbC50aWNrZXRzLm5leHQgIT0gbG9ja3ZhbC50aWNrZXRzLm93bmVyKQot
CQlsb2NrdmFsLnRpY2tldHMub3duZXIgPSBSRUFEX09OQ0UobG9jay0+dGlja2V0cy5vd25lcik7
Ci0KLQlzbXBfbWIoKTsKLX0KLQotc3RhdGljIGlubGluZSBpbnQgYXJjaF9zcGluX3RyeWxvY2so
YXJjaF9zcGlubG9ja190ICpsb2NrKQotewotCXUzMiB0bXAsIGNvbnRlbmRlZCwgcmVzOwotCXUz
MiB0aWNrZXRfbmV4dCA9IDEgPDwgVElDS0VUX05FWFQ7Ci0JdTMyICpwID0gJmxvY2stPmxvY2s7
Ci0KLQlkbyB7Ci0JCWFzbSB2b2xhdGlsZSAoCi0JCSIJbGRleC53CQklMCwgKCUzKSAgIFxuIgot
CQkiCW1vdmkJCSUyLCAxCSAgIFxuIgotCQkiCXJvdGxpCQklMSwgJTAsIDE2IFxuIgotCQkiCWNt
cG5lCQklMSwgJTAgICAgIFxuIgotCQkiCWJ0CQkxZiAgICAgICAgIFxuIgotCQkiCW1vdmkJCSUy
LCAwCSAgIFxuIgotCQkiCWFkZAkJJTAsICUwLCAlNCBcbiIKLQkJIglzdGV4LncJCSUwLCAoJTMp
ICAgXG4iCi0JCSIxOgkJCQkgICBcbiIKLQkJOiAiPSZyIiAocmVzKSwgIj0mciIgKHRtcCksICI9
JnIiIChjb250ZW5kZWQpCi0JCTogInIiKHApLCAiciIodGlja2V0X25leHQpCi0JCTogImNjIik7
Ci0JfSB3aGlsZSAoIXJlcyk7Ci0KLQlpZiAoIWNvbnRlbmRlZCkKLQkJc21wX21iKCk7Ci0KLQly
ZXR1cm4gIWNvbnRlbmRlZDsKLX0KLQotc3RhdGljIGlubGluZSB2b2lkIGFyY2hfc3Bpbl91bmxv
Y2soYXJjaF9zcGlubG9ja190ICpsb2NrKQotewotCXNtcF9tYigpOwotCVdSSVRFX09OQ0UobG9j
ay0+dGlja2V0cy5vd25lciwgbG9jay0+dGlja2V0cy5vd25lciArIDEpOwotfQotCi1zdGF0aWMg
aW5saW5lIGludCBhcmNoX3NwaW5fdmFsdWVfdW5sb2NrZWQoYXJjaF9zcGlubG9ja190IGxvY2sp
Ci17Ci0JcmV0dXJuIGxvY2sudGlja2V0cy5vd25lciA9PSBsb2NrLnRpY2tldHMubmV4dDsKLX0K
LQotc3RhdGljIGlubGluZSBpbnQgYXJjaF9zcGluX2lzX2xvY2tlZChhcmNoX3NwaW5sb2NrX3Qg
KmxvY2spCi17Ci0JcmV0dXJuICFhcmNoX3NwaW5fdmFsdWVfdW5sb2NrZWQoUkVBRF9PTkNFKCps
b2NrKSk7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgaW50IGFyY2hfc3Bpbl9pc19jb250ZW5kZWQoYXJj
aF9zcGlubG9ja190ICpsb2NrKQotewotCXN0cnVjdCBfX3Jhd190aWNrZXRzIHRpY2tldHMgPSBS
RUFEX09OQ0UobG9jay0+dGlja2V0cyk7Ci0KLQlyZXR1cm4gKHRpY2tldHMubmV4dCAtIHRpY2tl
dHMub3duZXIpID4gMTsKLX0KLSNkZWZpbmUgYXJjaF9zcGluX2lzX2NvbnRlbmRlZAlhcmNoX3Nw
aW5faXNfY29udGVuZGVkCi0KLSNpbmNsdWRlIDxhc20vcXJ3bG9jay5oPgotCi0jZW5kaWYgLyog
X19BU01fQ1NLWV9TUElOTE9DS19IICovCmRpZmYgLS1naXQgYS9hcmNoL2Nza3kvaW5jbHVkZS9h
c20vc3BpbmxvY2tfdHlwZXMuaCBiL2FyY2gvY3NreS9pbmNsdWRlL2FzbS9zcGlubG9ja190eXBl
cy5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBkYjg3YTEyYzM4MjcuLjAwMDAwMDAw
MDAwMAotLS0gYS9hcmNoL2Nza3kvaW5jbHVkZS9hc20vc3BpbmxvY2tfdHlwZXMuaAorKysgL2Rl
di9udWxsCkBAIC0xLDI3ICswLDAgQEAKLS8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwt
Mi4wICovCi0KLSNpZm5kZWYgX19BU01fQ1NLWV9TUElOTE9DS19UWVBFU19ICi0jZGVmaW5lIF9f
QVNNX0NTS1lfU1BJTkxPQ0tfVFlQRVNfSAotCi0jaWZuZGVmIF9fTElOVVhfU1BJTkxPQ0tfVFlQ
RVNfUkFXX0gKLSMgZXJyb3IgInBsZWFzZSBkb24ndCBpbmNsdWRlIHRoaXMgZmlsZSBkaXJlY3Rs
eSIKLSNlbmRpZgotCi0jZGVmaW5lIFRJQ0tFVF9ORVhUCTE2Ci0KLXR5cGVkZWYgc3RydWN0IHsK
LQl1bmlvbiB7Ci0JCXUzMiBsb2NrOwotCQlzdHJ1Y3QgX19yYXdfdGlja2V0cyB7Ci0JCQkvKiBs
aXR0bGUgZW5kaWFuICovCi0JCQl1MTYgb3duZXI7Ci0JCQl1MTYgbmV4dDsKLQkJfSB0aWNrZXRz
OwotCX07Ci19IGFyY2hfc3BpbmxvY2tfdDsKLQotI2RlZmluZSBfX0FSQ0hfU1BJTl9MT0NLX1VO
TE9DS0VECXsgeyAwIH0gfQotCi0jaW5jbHVkZSA8YXNtLWdlbmVyaWMvcXJ3bG9ja190eXBlcy5o
PgotCi0jZW5kaWYgLyogX19BU01fQ1NLWV9TUElOTE9DS19UWVBFU19IICovCi0tIAoyLjI1LjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCk9wZW5SSVND
IG1haWxpbmcgbGlzdApPcGVuUklTQ0BsaXN0cy5saWJyZWNvcmVzLm9yZwpodHRwczovL2xpc3Rz
LmxpYnJlY29yZXMub3JnL2xpc3RpbmZvL29wZW5yaXNjCg==
