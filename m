Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id B87A64DE59F
	for <lists+openrisc@lfdr.de>; Sat, 19 Mar 2022 04:55:29 +0100 (CET)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 9EB9B24816;
	Sat, 19 Mar 2022 04:55:29 +0100 (CET)
Received: from ams.source.kernel.org (ams.source.kernel.org [145.40.68.75])
 by mail.librecores.org (Postfix) with ESMTPS id 644FA24807
 for <openrisc@lists.librecores.org>; Sat, 19 Mar 2022 04:55:28 +0100 (CET)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by ams.source.kernel.org (Postfix) with ESMTPS id EFD33B825D5;
 Sat, 19 Mar 2022 03:55:27 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id CB845C340EF;
 Sat, 19 Mar 2022 03:55:23 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1647662126;
 bh=DtqXTRMwn6ZDNRkKBVKCDZ1PQKK42UIH68tftsWwzj8=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=Mw+23Ww8OMZKukfKBBTrry7rqAWD/Qf2t8u9SMF6E7rEH/zcKUD0OU+W/z6tTqkaS
 wnG+mkmwi28uQG6BfYexiKKH/aTAunYD3KFOQsjhw2QOPRaB2PlLIrnjBZOgnPHDov
 XJoH3Mz9+nD1S0me+YYuNtrLps9DeBs5wK6KL9UJL5ArDehB9Uxx4F7/rczQciSyBQ
 zoX4weeS5/2L8gbCPHXsRVdN1VAYrG1F1AnH+PZsTR9IeEQSI11FosR4C3XNxcjEMb
 69CgxHrsfGEPjJ5Y3d8GzVkMV0FnNusjXMfAt3BdXk76OAnr+Z4cZXwp8Sjb4DTRZb
 un2jlHDU3bYCg==
From: guoren@kernel.org
To: guoren@kernel.org, palmer@dabbelt.com, arnd@arndb.de, boqun.feng@gmail.com,
 longman@redhat.com, peterz@infradead.org
Date: Sat, 19 Mar 2022 11:54:56 +0800
Message-Id: <20220319035457.2214979-5-guoren@kernel.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220319035457.2214979-1-guoren@kernel.org>
References: <20220319035457.2214979-1-guoren@kernel.org>
MIME-Version: 1.0
Subject: [OpenRISC] [PATCH V2 4/5] RISC-V: Move to ticket-spinlocks & RW
 locks
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: linux-arch@vger.kernel.org, linux-kernel@vger.kernel.org,
 linux-csky@vger.kernel.org, openrisc@lists.librecores.org,
 Palmer Dabbelt <palmer@rivosinc.com>, linux-riscv@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

RnJvbTogUGFsbWVyIERhYmJlbHQgPHBhbG1lckByaXZvc2luYy5jb20+CgpPdXIgZXhpc3Rpbmcg
c3BpbmxvY2tzIGFyZW4ndCBmYWlyIGFuZCByZXBsYWNpbmcgdGhlbSBoYXMgYmVlbiBvbiB0aGUK
VE9ETyBsaXN0IGZvciBhIGxvbmcgdGltZS4gIFRoaXMgbW92ZXMgdG8gdGhlIHJlY2VudGx5LWlu
dHJvZHVjZWQgdGlja2V0CnNwaW5sb2Nrcywgd2hpY2ggYXJlIHNpbXBsZSBlbm91Z2ggdGhhdCB0
aGV5IGFyZSBsaWtlbHkgdG8gYmUgY29ycmVjdAphbmQgZmFzdCBvbiB0aGUgdmFzdCBtYWpvcml0
eSBvZiBleHRhbnQgaW1wbGVtZW50YXRpb25zLgoKV2l0aCB0aGUgbW92ZSB0byBmYWlyIHNwaW5s
b2Nrcywgd2UgbWlnaHQgYXMgd2VsbCBtb3ZlIHRvIGZhaXIgcndsb2Nrcy4KClNpZ25lZC1vZmYt
Ynk6IFBhbG1lciBEYWJiZWx0IDxwYWxtZXJAcml2b3NpbmMuY29tPgotLS0KIGFyY2gvcmlzY3Yv
S2NvbmZpZyAgICAgICAgICAgICAgICAgICAgICB8ICAgMSArCiBhcmNoL3Jpc2N2L2luY2x1ZGUv
YXNtL0tidWlsZCAgICAgICAgICAgfCAgIDIgKwogYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlu
bG9jay5oICAgICAgIHwgMTM1IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogYXJjaC9yaXNjdi9p
bmNsdWRlL2FzbS9zcGlubG9ja190eXBlcy5oIHwgIDI1IC0tLS0tCiA0IGZpbGVzIGNoYW5nZWQs
IDMgaW5zZXJ0aW9ucygrKSwgMTYwIGRlbGV0aW9ucygtKQogZGVsZXRlIG1vZGUgMTAwNjQ0IGFy
Y2gvcmlzY3YvaW5jbHVkZS9hc20vc3BpbmxvY2suaAogZGVsZXRlIG1vZGUgMTAwNjQ0IGFyY2gv
cmlzY3YvaW5jbHVkZS9hc20vc3BpbmxvY2tfdHlwZXMuaAoKZGlmZiAtLWdpdCBhL2FyY2gvcmlz
Y3YvS2NvbmZpZyBiL2FyY2gvcmlzY3YvS2NvbmZpZwppbmRleCA1YWRjYmQ5YjVlODguLmZlYjcw
MzBjZmI2ZCAxMDA2NDQKLS0tIGEvYXJjaC9yaXNjdi9LY29uZmlnCisrKyBiL2FyY2gvcmlzY3Yv
S2NvbmZpZwpAQCAtMzgsNiArMzgsNyBAQCBjb25maWcgUklTQ1YKIAlzZWxlY3QgQVJDSF9TVVBQ
T1JUU19ERUJVR19QQUdFQUxMT0MgaWYgTU1VCiAJc2VsZWN0IEFSQ0hfU1VQUE9SVFNfSFVHRVRM
QkZTIGlmIE1NVQogCXNlbGVjdCBBUkNIX1VTRV9NRU1URVNUCisJc2VsZWN0IEFSQ0hfVVNFX1FV
RVVFRF9SV0xPQ0tTCiAJc2VsZWN0IEFSQ0hfV0FOVF9ERUZBVUxUX1RPUERPV05fTU1BUF9MQVlP
VVQgaWYgTU1VCiAJc2VsZWN0IEFSQ0hfV0FOVF9GUkFNRV9QT0lOVEVSUwogCXNlbGVjdCBBUkNI
X1dBTlRfSFVHRV9QTURfU0hBUkUgaWYgNjRCSVQKZGlmZiAtLWdpdCBhL2FyY2gvcmlzY3YvaW5j
bHVkZS9hc20vS2J1aWxkIGIvYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9LYnVpbGQKaW5kZXggNTdi
ODZmZDk5MTZjLi45OWRhYjU0NGU1ZmEgMTAwNjQ0Ci0tLSBhL2FyY2gvcmlzY3YvaW5jbHVkZS9h
c20vS2J1aWxkCisrKyBiL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vS2J1aWxkCkBAIC0yLDUgKzIs
NyBAQAogZ2VuZXJpYy15ICs9IGVhcmx5X2lvcmVtYXAuaAogZ2VuZXJpYy15ICs9IGZsYXQuaAog
Z2VuZXJpYy15ICs9IGt2bV9wYXJhLmgKK2dlbmVyaWMteSArPSBzcGlubG9ja190eXBlcy5oCitn
ZW5lcmljLXkgKz0gc3BpbmxvY2suaAogZ2VuZXJpYy15ICs9IHVzZXIuaAogZ2VuZXJpYy15ICs9
IHZtbGludXgubGRzLmgKZGlmZiAtLWdpdCBhL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3Bpbmxv
Y2suaCBiL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3BpbmxvY2suaApkZWxldGVkIGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggZjRmN2ZhMWI3Y2E4Li4wMDAwMDAwMDAwMDAKLS0tIGEvYXJjaC9yaXNj
di9pbmNsdWRlL2FzbS9zcGlubG9jay5oCisrKyAvZGV2L251bGwKQEAgLTEsMTM1ICswLDAgQEAK
LS8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkgKi8KLS8qCi0gKiBDb3B5
cmlnaHQgKEMpIDIwMTUgUmVnZW50cyBvZiB0aGUgVW5pdmVyc2l0eSBvZiBDYWxpZm9ybmlhCi0g
KiBDb3B5cmlnaHQgKEMpIDIwMTcgU2lGaXZlCi0gKi8KLQotI2lmbmRlZiBfQVNNX1JJU0NWX1NQ
SU5MT0NLX0gKLSNkZWZpbmUgX0FTTV9SSVNDVl9TUElOTE9DS19ICi0KLSNpbmNsdWRlIDxsaW51
eC9rZXJuZWwuaD4KLSNpbmNsdWRlIDxhc20vY3VycmVudC5oPgotI2luY2x1ZGUgPGFzbS9mZW5j
ZS5oPgotCi0vKgotICogU2ltcGxlIHNwaW4gbG9jayBvcGVyYXRpb25zLiAgVGhlc2UgcHJvdmlk
ZSBubyBmYWlybmVzcyBndWFyYW50ZWVzLgotICovCi0KLS8qIEZJWE1FOiBSZXBsYWNlIHRoaXMg
d2l0aCBhIHRpY2tldCBsb2NrLCBsaWtlIE1JUFMuICovCi0KLSNkZWZpbmUgYXJjaF9zcGluX2lz
X2xvY2tlZCh4KQkoUkVBRF9PTkNFKCh4KS0+bG9jaykgIT0gMCkKLQotc3RhdGljIGlubGluZSB2
b2lkIGFyY2hfc3Bpbl91bmxvY2soYXJjaF9zcGlubG9ja190ICpsb2NrKQotewotCXNtcF9zdG9y
ZV9yZWxlYXNlKCZsb2NrLT5sb2NrLCAwKTsKLX0KLQotc3RhdGljIGlubGluZSBpbnQgYXJjaF9z
cGluX3RyeWxvY2soYXJjaF9zcGlubG9ja190ICpsb2NrKQotewotCWludCB0bXAgPSAxLCBidXN5
OwotCi0JX19hc21fXyBfX3ZvbGF0aWxlX18gKAotCQkiCWFtb3N3YXAudyAlMCwgJTIsICUxXG4i
Ci0JCVJJU0NWX0FDUVVJUkVfQkFSUklFUgotCQk6ICI9ciIgKGJ1c3kpLCAiK0EiIChsb2NrLT5s
b2NrKQotCQk6ICJyIiAodG1wKQotCQk6ICJtZW1vcnkiKTsKLQotCXJldHVybiAhYnVzeTsKLX0K
LQotc3RhdGljIGlubGluZSB2b2lkIGFyY2hfc3Bpbl9sb2NrKGFyY2hfc3BpbmxvY2tfdCAqbG9j
aykKLXsKLQl3aGlsZSAoMSkgewotCQlpZiAoYXJjaF9zcGluX2lzX2xvY2tlZChsb2NrKSkKLQkJ
CWNvbnRpbnVlOwotCi0JCWlmIChhcmNoX3NwaW5fdHJ5bG9jayhsb2NrKSkKLQkJCWJyZWFrOwot
CX0KLX0KLQotLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqLwotCi1zdGF0aWMgaW5saW5lIHZvaWQgYXJjaF9yZWFkX2xvY2soYXJjaF9y
d2xvY2tfdCAqbG9jaykKLXsKLQlpbnQgdG1wOwotCi0JX19hc21fXyBfX3ZvbGF0aWxlX18oCi0J
CSIxOglsci53CSUxLCAlMFxuIgotCQkiCWJsdHoJJTEsIDFiXG4iCi0JCSIJYWRkaQklMSwgJTEs
IDFcbiIKLQkJIglzYy53CSUxLCAlMSwgJTBcbiIKLQkJIglibmV6CSUxLCAxYlxuIgotCQlSSVND
Vl9BQ1FVSVJFX0JBUlJJRVIKLQkJOiAiK0EiIChsb2NrLT5sb2NrKSwgIj0mciIgKHRtcCkKLQkJ
OjogIm1lbW9yeSIpOwotfQotCi1zdGF0aWMgaW5saW5lIHZvaWQgYXJjaF93cml0ZV9sb2NrKGFy
Y2hfcndsb2NrX3QgKmxvY2spCi17Ci0JaW50IHRtcDsKLQotCV9fYXNtX18gX192b2xhdGlsZV9f
KAotCQkiMToJbHIudwklMSwgJTBcbiIKLQkJIglibmV6CSUxLCAxYlxuIgotCQkiCWxpCSUxLCAt
MVxuIgotCQkiCXNjLncJJTEsICUxLCAlMFxuIgotCQkiCWJuZXoJJTEsIDFiXG4iCi0JCVJJU0NW
X0FDUVVJUkVfQkFSUklFUgotCQk6ICIrQSIgKGxvY2stPmxvY2spLCAiPSZyIiAodG1wKQotCQk6
OiAibWVtb3J5Iik7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgaW50IGFyY2hfcmVhZF90cnlsb2NrKGFy
Y2hfcndsb2NrX3QgKmxvY2spCi17Ci0JaW50IGJ1c3k7Ci0KLQlfX2FzbV9fIF9fdm9sYXRpbGVf
XygKLQkJIjE6CWxyLncJJTEsICUwXG4iCi0JCSIJYmx0egklMSwgMWZcbiIKLQkJIglhZGRpCSUx
LCAlMSwgMVxuIgotCQkiCXNjLncJJTEsICUxLCAlMFxuIgotCQkiCWJuZXoJJTEsIDFiXG4iCi0J
CVJJU0NWX0FDUVVJUkVfQkFSUklFUgotCQkiMTpcbiIKLQkJOiAiK0EiIChsb2NrLT5sb2NrKSwg
Ij0mciIgKGJ1c3kpCi0JCTo6ICJtZW1vcnkiKTsKLQotCXJldHVybiAhYnVzeTsKLX0KLQotc3Rh
dGljIGlubGluZSBpbnQgYXJjaF93cml0ZV90cnlsb2NrKGFyY2hfcndsb2NrX3QgKmxvY2spCi17
Ci0JaW50IGJ1c3k7Ci0KLQlfX2FzbV9fIF9fdm9sYXRpbGVfXygKLQkJIjE6CWxyLncJJTEsICUw
XG4iCi0JCSIJYm5legklMSwgMWZcbiIKLQkJIglsaQklMSwgLTFcbiIKLQkJIglzYy53CSUxLCAl
MSwgJTBcbiIKLQkJIglibmV6CSUxLCAxYlxuIgotCQlSSVNDVl9BQ1FVSVJFX0JBUlJJRVIKLQkJ
IjE6XG4iCi0JCTogIitBIiAobG9jay0+bG9jayksICI9JnIiIChidXN5KQotCQk6OiAibWVtb3J5
Iik7Ci0KLQlyZXR1cm4gIWJ1c3k7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdm9pZCBhcmNoX3JlYWRf
dW5sb2NrKGFyY2hfcndsb2NrX3QgKmxvY2spCi17Ci0JX19hc21fXyBfX3ZvbGF0aWxlX18oCi0J
CVJJU0NWX1JFTEVBU0VfQkFSUklFUgotCQkiCWFtb2FkZC53IHgwLCAlMSwgJTBcbiIKLQkJOiAi
K0EiIChsb2NrLT5sb2NrKQotCQk6ICJyIiAoLTEpCi0JCTogIm1lbW9yeSIpOwotfQotCi1zdGF0
aWMgaW5saW5lIHZvaWQgYXJjaF93cml0ZV91bmxvY2soYXJjaF9yd2xvY2tfdCAqbG9jaykKLXsK
LQlzbXBfc3RvcmVfcmVsZWFzZSgmbG9jay0+bG9jaywgMCk7Ci19Ci0KLSNlbmRpZiAvKiBfQVNN
X1JJU0NWX1NQSU5MT0NLX0ggKi8KZGlmZiAtLWdpdCBhL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20v
c3BpbmxvY2tfdHlwZXMuaCBiL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3BpbmxvY2tfdHlwZXMu
aApkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggNWEzNWE0OTUwNWRhLi4wMDAwMDAwMDAw
MDAKLS0tIGEvYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9ja190eXBlcy5oCisrKyAvZGV2
L251bGwKQEAgLTEsMjUgKzAsMCBAQAotLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0y
LjAtb25seSAqLwotLyoKLSAqIENvcHlyaWdodCAoQykgMjAxNSBSZWdlbnRzIG9mIHRoZSBVbml2
ZXJzaXR5IG9mIENhbGlmb3JuaWEKLSAqLwotCi0jaWZuZGVmIF9BU01fUklTQ1ZfU1BJTkxPQ0tf
VFlQRVNfSAotI2RlZmluZSBfQVNNX1JJU0NWX1NQSU5MT0NLX1RZUEVTX0gKLQotI2lmbmRlZiBf
X0xJTlVYX1NQSU5MT0NLX1RZUEVTX1JBV19ICi0jIGVycm9yICJwbGVhc2UgZG9uJ3QgaW5jbHVk
ZSB0aGlzIGZpbGUgZGlyZWN0bHkiCi0jZW5kaWYKLQotdHlwZWRlZiBzdHJ1Y3QgewotCXZvbGF0
aWxlIHVuc2lnbmVkIGludCBsb2NrOwotfSBhcmNoX3NwaW5sb2NrX3Q7Ci0KLSNkZWZpbmUgX19B
UkNIX1NQSU5fTE9DS19VTkxPQ0tFRAl7IDAgfQotCi10eXBlZGVmIHN0cnVjdCB7Ci0Jdm9sYXRp
bGUgdW5zaWduZWQgaW50IGxvY2s7Ci19IGFyY2hfcndsb2NrX3Q7Ci0KLSNkZWZpbmUgX19BUkNI
X1JXX0xPQ0tfVU5MT0NLRUQJCXsgMCB9Ci0KLSNlbmRpZiAvKiBfQVNNX1JJU0NWX1NQSU5MT0NL
X1RZUEVTX0ggKi8KLS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KT3BlblJJU0MgbWFpbGluZyBsaXN0Ck9wZW5SSVNDQGxpc3RzLmxpYnJl
Y29yZXMub3JnCmh0dHBzOi8vbGlzdHMubGlicmVjb3Jlcy5vcmcvbGlzdGluZm8vb3BlbnJpc2MK
