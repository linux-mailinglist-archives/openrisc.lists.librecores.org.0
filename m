Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id 498F84DE597
	for <lists+openrisc@lfdr.de>; Sat, 19 Mar 2022 04:55:20 +0100 (CET)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 2178A2480E;
	Sat, 19 Mar 2022 04:55:20 +0100 (CET)
Received: from dfw.source.kernel.org (dfw.source.kernel.org [139.178.84.217])
 by mail.librecores.org (Postfix) with ESMTPS id 4417124807
 for <openrisc@lists.librecores.org>; Sat, 19 Mar 2022 04:55:18 +0100 (CET)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by dfw.source.kernel.org (Postfix) with ESMTPS id 2BA47616ED;
 Sat, 19 Mar 2022 03:55:17 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id AC82CC340EF;
 Sat, 19 Mar 2022 03:55:13 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1647662116;
 bh=/bReo6UVHKvKAiVeuG78E1Bfu20TwWPnkpvpQ38eLMw=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=tw1o6hQeHP8BdNW9F2BDp9jWTMRAzO9NzPUeRJ1pFXcix/NrEoOhvkB9xDhlqVKVI
 zQMw9nJaZfYuGC2z8Os6CpcQmRQcdG+MdLHIbZeVzmJDr7fk7zKomcuIIkTluvG6IR
 bGozB5kWVnYOqIckguD1i835j9uyC2le0EO9GXi72QFIuLFa3GMOb7etZKFlgMlJq1
 CrxPyH08y2ZN7DtmohrCowviTsM0vOUXxjRnAfZMLm7i1rUfi4L4aSsOk8dctj4GZd
 tlemMNcw0SIR0Dzh56L+iKPhzVDyWtbBoYeoW4N6X/9ZV3Fu0/oVMGC972BQlJmdmF
 l109uoGQf8rqA==
From: guoren@kernel.org
To: guoren@kernel.org, palmer@dabbelt.com, arnd@arndb.de, boqun.feng@gmail.com,
 longman@redhat.com, peterz@infradead.org
Date: Sat, 19 Mar 2022 11:54:53 +0800
Message-Id: <20220319035457.2214979-2-guoren@kernel.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220319035457.2214979-1-guoren@kernel.org>
References: <20220319035457.2214979-1-guoren@kernel.org>
MIME-Version: 1.0
Subject: [OpenRISC] [PATCH V2 1/5] asm-generic: ticket-lock: New generic
 ticket-based spinlock
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: linux-arch@vger.kernel.org, linux-kernel@vger.kernel.org,
 linux-csky@vger.kernel.org, openrisc@lists.librecores.org,
 Palmer Dabbelt <palmer@rivosinc.com>, linux-riscv@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

RnJvbTogUGV0ZXIgWmlqbHN0cmEgPHBldGVyekBpbmZyYWRlYWQub3JnPgoKVGhpcyBpcyBhIHNp
bXBsZSwgZmFpciBzcGlubG9jay4gIFNwZWNpZmljYWxseSBpdCBkb2Vzbid0IGhhdmUgYWxsIHRo
ZQpzdWJ0bGUgbWVtb3J5IG1vZGVsIGRlcGVuZGVuY2llcyB0aGF0IHFzcGlubG9jayBoYXMsIHdo
aWNoIG1ha2VzIGl0IG1vcmUKc3VpdGFibGUgZm9yIHNpbXBsZSBzeXN0ZW1zIGFzIGl0IGlzIG1v
cmUgbGlrZWx5IHRvIGJlIGNvcnJlY3QuCgpbUGFsbWVyOiBjb21taXQgdGV4dF0KU2lnbmVkLW9m
Zi1ieTogUGFsbWVyIERhYmJlbHQgPHBhbG1lckByaXZvc2luYy5jb20+CgotLQoKSSBoYXZlIHNw
ZWNpZmljYWxseSBub3QgaW5jbHVkZWQgUGV0ZXIncyBTT0Igb24gdGhpcywgYXMgaGUgc2VudCBo
aXMKb3JpZ2luYWwgcGF0Y2gKPGh0dHBzOi8vbG9yZS5rZXJuZWwub3JnL2xrbWwvWUhiQkJ1VkZO
bkk0a2pqM0BoaXJlei5wcm9ncmFtbWluZy5raWNrcy1hc3MubmV0Lz4Kd2l0aG91dCBvbmUuCi0t
LQogaW5jbHVkZS9hc20tZ2VuZXJpYy9zcGlubG9jay5oICAgICAgICAgIHwgMTEgKysrLQogaW5j
bHVkZS9hc20tZ2VuZXJpYy9zcGlubG9ja190eXBlcy5oICAgIHwgMTUgKysrKysKIGluY2x1ZGUv
YXNtLWdlbmVyaWMvdGlja2V0LWxvY2stdHlwZXMuaCB8IDExICsrKysKIGluY2x1ZGUvYXNtLWdl
bmVyaWMvdGlja2V0LWxvY2suaCAgICAgICB8IDg2ICsrKysrKysrKysrKysrKysrKysrKysrKysK
IDQgZmlsZXMgY2hhbmdlZCwgMTIwIGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25zKC0pCiBjcmVh
dGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9hc20tZ2VuZXJpYy9zcGlubG9ja190eXBlcy5oCiBjcmVh
dGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9hc20tZ2VuZXJpYy90aWNrZXQtbG9jay10eXBlcy5oCiBj
cmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9hc20tZ2VuZXJpYy90aWNrZXQtbG9jay5oCgpkaWZm
IC0tZ2l0IGEvaW5jbHVkZS9hc20tZ2VuZXJpYy9zcGlubG9jay5oIGIvaW5jbHVkZS9hc20tZ2Vu
ZXJpYy9zcGlubG9jay5oCmluZGV4IGFkYWY2YWNhYjE3Mi4uYThlMmFhMWJjZWE0IDEwMDY0NAot
LS0gYS9pbmNsdWRlL2FzbS1nZW5lcmljL3NwaW5sb2NrLmgKKysrIGIvaW5jbHVkZS9hc20tZ2Vu
ZXJpYy9zcGlubG9jay5oCkBAIC0xLDEyICsxLDE3IEBACiAvKiBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogR1BMLTIuMCAqLwogI2lmbmRlZiBfX0FTTV9HRU5FUklDX1NQSU5MT0NLX0gKICNkZWZp
bmUgX19BU01fR0VORVJJQ19TUElOTE9DS19ICisKIC8qCi0gKiBZb3UgbmVlZCB0byBpbXBsZW1l
bnQgYXNtL3NwaW5sb2NrLmggZm9yIFNNUCBzdXBwb3J0LiBUaGUgZ2VuZXJpYwotICogdmVyc2lv
biBkb2VzIG5vdCBoYW5kbGUgU01QLgorICogVXNpbmcgdGlja2V0LXNwaW5sb2NrLmggYXMgZ2Vu
ZXJpYyBmb3IgU01QIHN1cHBvcnQuCiAgKi8KICNpZmRlZiBDT05GSUdfU01QCi0jZXJyb3IgbmVl
ZCBhbiBhcmNoaXRlY3R1cmUgc3BlY2lmaWMgYXNtL3NwaW5sb2NrLmgKKyNpbmNsdWRlIDxhc20t
Z2VuZXJpYy90aWNrZXQtbG9jay5oPgorI2lmZGVmIENPTkZJR19RVUVVRURfUldMT0NLUworI2lu
Y2x1ZGUgPGFzbS1nZW5lcmljL3Fyd2xvY2suaD4KKyNlbHNlCisjZXJyb3IgUGxlYXNlIHNlbGVj
dCBBUkNIX1VTRV9RVUVVRURfUldMT0NLUyBpbiBhcmNoaXRlY3R1cmUgS2NvbmZpZworI2VuZGlm
CiAjZW5kaWYKIAogI2VuZGlmIC8qIF9fQVNNX0dFTkVSSUNfU1BJTkxPQ0tfSCAqLwpkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9hc20tZ2VuZXJpYy9zcGlubG9ja190eXBlcy5oIGIvaW5jbHVkZS9hc20t
Z2VuZXJpYy9zcGlubG9ja190eXBlcy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAwMC4uYmE4ZWY0YjczMWJhCi0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS9hc20tZ2Vu
ZXJpYy9zcGlubG9ja190eXBlcy5oCkBAIC0wLDAgKzEsMTUgQEAKKy8qIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wICovCisjaWZuZGVmIF9fQVNNX0dFTkVSSUNfU1BJTkxPQ0tfVFlQ
RVNfSAorI2RlZmluZSBfX0FTTV9HRU5FUklDX1NQSU5MT0NLX1RZUEVTX0gKKworLyoKKyAqIFVz
aW5nIHRpY2tldCBzcGlubG9jayBhcyBnZW5lcmljIGZvciBTTVAgc3VwcG9ydC4KKyAqLworI2lm
ZGVmIENPTkZJR19TTVAKKyNpbmNsdWRlIDxhc20tZ2VuZXJpYy90aWNrZXQtbG9jay10eXBlcy5o
PgorI2luY2x1ZGUgPGFzbS1nZW5lcmljL3Fyd2xvY2tfdHlwZXMuaD4KKyNlbHNlCisjZXJyb3Ig
VGhlIGFzbS1nZW5lcmljL3NwaW5sb2NrX3R5cGVzLmggaXMgbm90IGZvciBDT05GSUdfU01QPW4K
KyNlbmRpZgorCisjZW5kaWYgLyogX19BU01fR0VORVJJQ19TUElOTE9DS19UWVBFU19IICovCmRp
ZmYgLS1naXQgYS9pbmNsdWRlL2FzbS1nZW5lcmljL3RpY2tldC1sb2NrLXR5cGVzLmggYi9pbmNs
dWRlL2FzbS1nZW5lcmljL3RpY2tldC1sb2NrLXR5cGVzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi44Mjk3NTlhZWRkYTgKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNs
dWRlL2FzbS1nZW5lcmljL3RpY2tldC1sb2NrLXR5cGVzLmgKQEAgLTAsMCArMSwxMSBAQAorLyog
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKworI2lmbmRlZiBfX0FTTV9HRU5F
UklDX1RJQ0tFVF9MT0NLX1RZUEVTX0gKKyNkZWZpbmUgX19BU01fR0VORVJJQ19USUNLRVRfTE9D
S19UWVBFU19ICisKKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgordHlwZWRlZiBhdG9taWNfdCBh
cmNoX3NwaW5sb2NrX3Q7CisKKyNkZWZpbmUgX19BUkNIX1NQSU5fTE9DS19VTkxPQ0tFRAlBVE9N
SUNfSU5JVCgwKQorCisjZW5kaWYgLyogX19BU01fR0VORVJJQ19USUNLRVRfTE9DS19UWVBFU19I
ICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2FzbS1nZW5lcmljL3RpY2tldC1sb2NrLmggYi9pbmNs
dWRlL2FzbS1nZW5lcmljL3RpY2tldC1sb2NrLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi41OTM3M2RlM2UzMmEKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNsdWRlL2Fz
bS1nZW5lcmljL3RpY2tldC1sb2NrLmgKQEAgLTAsMCArMSw4NiBAQAorLyogU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKworLyoKKyAqICdHZW5lcmljJyB0aWNrZXQtbG9jayBp
bXBsZW1lbnRhdGlvbi4KKyAqCisgKiBJdCByZWxpZXMgb24gYXRvbWljX2ZldGNoX2FkZCgpIGhh
dmluZyB3ZWxsIGRlZmluZWQgZm9yd2FyZCBwcm9ncmVzcworICogZ3VhcmFudGVlcyB1bmRlciBj
b250ZW50aW9uLiBJZiB5b3VyIGFyY2hpdGVjdHVyZSBjYW5ub3QgcHJvdmlkZSB0aGlzLCBzdGlj
aworICogdG8gYSB0ZXN0LWFuZC1zZXQgbG9jay4KKyAqCisgKiBJdCBhbHNvIHJlbGllcyBvbiBh
dG9taWNfZmV0Y2hfYWRkKCkgYmVpbmcgc2FmZSB2cyBzbXBfc3RvcmVfcmVsZWFzZSgpIG9uIGEK
KyAqIHN1Yi13b3JkIG9mIHRoZSB2YWx1ZS4gVGhpcyBpcyBnZW5lcmFsbHkgdHJ1ZSBmb3IgYW55
dGhpbmcgTEwvU0MgYWx0aG91Z2gKKyAqIHlvdSdkIGJlIGhhcmQgcHJlc3NlZCB0byBmaW5kIGFu
eXRoaW5nIHVzZWZ1bCBpbiBhcmNoaXRlY3R1cmUgc3BlY2lmaWNhdGlvbnMKKyAqIGFib3V0IHRo
aXMuIElmIHlvdXIgYXJjaGl0ZWN0dXJlIGNhbm5vdCBkbyB0aGlzIHlvdSBtaWdodCBiZSBiZXR0
ZXIgb2ZmIHdpdGgKKyAqIGEgdGVzdC1hbmQtc2V0LgorICoKKyAqIEl0IGZ1cnRoZXIgYXNzdW1l
cyBhdG9taWNfKl9yZWxlYXNlKCkgKyBhdG9taWNfKl9hY3F1aXJlKCkgaXMgUkNwYyBhbmQgaGVu
Y2UKKyAqIHVzZXMgYXRvbWljX2ZldGNoX2FkZCgpIHdoaWNoIGlzIFNDIHRvIGNyZWF0ZSBhbiBS
Q3NjIGxvY2suCisgKgorICogVGhlIGltcGxlbWVudGF0aW9uIHVzZXMgc21wX2NvbmRfbG9hZF9h
Y3F1aXJlKCkgdG8gc3Bpbiwgc28gaWYgdGhlCisgKiBhcmNoaXRlY3R1cmUgaGFzIFdGRSBsaWtl
IGluc3RydWN0aW9ucyB0byBzbGVlcCBpbnN0ZWFkIG9mIHBvbGwgZm9yIHdvcmQKKyAqIG1vZGlm
aWNhdGlvbnMgYmUgc3VyZSB0byBpbXBsZW1lbnQgdGhhdCAoc2VlIEFSTTY0IGZvciBleGFtcGxl
KS4KKyAqCisgKi8KKworI2lmbmRlZiBfX0FTTV9HRU5FUklDX1RJQ0tFVF9MT0NLX0gKKyNkZWZp
bmUgX19BU01fR0VORVJJQ19USUNLRVRfTE9DS19ICisKKyNpbmNsdWRlIDxsaW51eC9hdG9taWMu
aD4KKyNpbmNsdWRlIDxhc20tZ2VuZXJpYy90aWNrZXQtbG9jay10eXBlcy5oPgorCitzdGF0aWMg
X19hbHdheXNfaW5saW5lIHZvaWQgdGlja2V0X2xvY2soYXJjaF9zcGlubG9ja190ICpsb2NrKQor
eworCXUzMiB2YWwgPSBhdG9taWNfZmV0Y2hfYWRkKDE8PDE2LCBsb2NrKTsgLyogU0MsIGdpdmVz
IHVzIFJDc2MgKi8KKwl1MTYgdGlja2V0ID0gdmFsID4+IDE2OworCisJaWYgKHRpY2tldCA9PSAo
dTE2KXZhbCkKKwkJcmV0dXJuOworCisJYXRvbWljX2NvbmRfcmVhZF9hY3F1aXJlKGxvY2ssIHRp
Y2tldCA9PSAodTE2KVZBTCk7Cit9CisKK3N0YXRpYyBfX2Fsd2F5c19pbmxpbmUgYm9vbCB0aWNr
ZXRfdHJ5bG9jayhhcmNoX3NwaW5sb2NrX3QgKmxvY2spCit7CisJdTMyIG9sZCA9IGF0b21pY19y
ZWFkKGxvY2spOworCisJaWYgKChvbGQgPj4gMTYpICE9IChvbGQgJiAweGZmZmYpKQorCQlyZXR1
cm4gZmFsc2U7CisKKwlyZXR1cm4gYXRvbWljX3RyeV9jbXB4Y2hnKGxvY2ssICZvbGQsIG9sZCAr
ICgxPDwxNikpOyAvKiBTQywgZm9yIFJDc2MgKi8KK30KKworc3RhdGljIF9fYWx3YXlzX2lubGlu
ZSB2b2lkIHRpY2tldF91bmxvY2soYXJjaF9zcGlubG9ja190ICpsb2NrKQoreworCXUxNiAqcHRy
ID0gKHUxNiAqKWxvY2sgKyBfX2lzX2RlZmluZWQoX19CSUdfRU5ESUFOKTsKKwl1MzIgdmFsID0g
YXRvbWljX3JlYWQobG9jayk7CisKKwlzbXBfc3RvcmVfcmVsZWFzZShwdHIsICh1MTYpdmFsICsg
MSk7Cit9CisKK3N0YXRpYyBfX2Fsd2F5c19pbmxpbmUgaW50IHRpY2tldF9pc19sb2NrZWQoYXJj
aF9zcGlubG9ja190ICpsb2NrKQoreworCXUzMiB2YWwgPSBhdG9taWNfcmVhZChsb2NrKTsKKwor
CXJldHVybiAoKHZhbCA+PiAxNikgIT0gKHZhbCAmIDB4ZmZmZikpOworfQorCitzdGF0aWMgX19h
bHdheXNfaW5saW5lIGludCB0aWNrZXRfaXNfY29udGVuZGVkKGFyY2hfc3BpbmxvY2tfdCAqbG9j
aykKK3sKKwl1MzIgdmFsID0gYXRvbWljX3JlYWQobG9jayk7CisKKwlyZXR1cm4gKHMxNikoKHZh
bCA+PiAxNikgLSAodmFsICYgMHhmZmZmKSkgPiAxOworfQorCitzdGF0aWMgX19hbHdheXNfaW5s
aW5lIGludCB0aWNrZXRfdmFsdWVfdW5sb2NrZWQoYXJjaF9zcGlubG9ja190IGxvY2spCit7CisJ
cmV0dXJuICF0aWNrZXRfaXNfbG9ja2VkKCZsb2NrKTsKK30KKworI2RlZmluZSBhcmNoX3NwaW5f
bG9jayhsKQkJdGlja2V0X2xvY2sobCkKKyNkZWZpbmUgYXJjaF9zcGluX3RyeWxvY2sobCkJCXRp
Y2tldF90cnlsb2NrKGwpCisjZGVmaW5lIGFyY2hfc3Bpbl91bmxvY2sobCkJCXRpY2tldF91bmxv
Y2sobCkKKyNkZWZpbmUgYXJjaF9zcGluX2lzX2xvY2tlZChsKQkJdGlja2V0X2lzX2xvY2tlZChs
KQorI2RlZmluZSBhcmNoX3NwaW5faXNfY29udGVuZGVkKGwpCXRpY2tldF9pc19jb250ZW5kZWQo
bCkKKyNkZWZpbmUgYXJjaF9zcGluX3ZhbHVlX3VubG9ja2VkKGwpCXRpY2tldF92YWx1ZV91bmxv
Y2tlZChsKQorCisjZW5kaWYgLyogX19BU01fR0VORVJJQ19USUNLRVRfTE9DS19IICovCi0tIAoy
LjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCk9w
ZW5SSVNDIG1haWxpbmcgbGlzdApPcGVuUklTQ0BsaXN0cy5saWJyZWNvcmVzLm9yZwpodHRwczov
L2xpc3RzLmxpYnJlY29yZXMub3JnL2xpc3RpbmZvL29wZW5yaXNjCg==
