Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id 7157435148D
	for <lists+openrisc@lfdr.de>; Thu,  1 Apr 2021 13:44:31 +0200 (CEST)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 2A5A8212EF;
	Thu,  1 Apr 2021 13:44:28 +0200 (CEST)
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by mail.librecores.org (Postfix) with ESMTPS id DBE8C21258
 for <openrisc@lists.librecores.org>; Wed, 31 Mar 2021 16:32:12 +0200 (CEST)
Received: by mail.kernel.org (Postfix) with ESMTPSA id 714AF60FF3;
 Wed, 31 Mar 2021 14:32:04 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1617201131;
 bh=1nsbIPHoYnp+y4hhU/ERIAox7V175+dXhzkr9rkZCgY=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=cW2e8TK/MVdFBPif56BK0z+HaiRyKiplVLsKPXZhc9cKMUoNS8THGYKAIdPHTdLPI
 VqBImBnGowMYxlacVGWlXCBvo5toHf6RttaKq5Gf/nV1Qx1TYuEnnNoWs3wWvyd9Xt
 wCLPwjmQWHGAhfCL7RGY6EMyqnIs//JUSG6UQ4dQT9zbKIO6D0YYqqyc2+KeAiKq7y
 opQ4Tf9BJxIbW0LZ54ZcP5KKy8yCmY+XClnU+dvMp8exURVpqAUL3TkxZ0hN674Myl
 Gd/5gyC8+LdG6hmlXseJDVkvkjvzURTJBCe3fY+B5pcta+OW+EV5FfVNBCwzwYe9ex
 YjoHB5tQnrqDA==
From: guoren@kernel.org
To: guoren@kernel.org
Date: Wed, 31 Mar 2021 14:30:34 +0000
Message-Id: <1617201040-83905-4-git-send-email-guoren@kernel.org>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1617201040-83905-1-git-send-email-guoren@kernel.org>
References: <1617201040-83905-1-git-send-email-guoren@kernel.org>
X-Mailman-Approved-At: Thu, 01 Apr 2021 13:44:25 +0200
Subject: [OpenRISC] [PATCH v6 3/9] riscv: locks: Introduce ticket-based
 spinlock implementation
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: linux-arch@vger.kernel.org, linux-xtensa@linux-xtensa.org,
 Guo Ren <guoren@linux.alibaba.com>, Arnd Bergmann <arnd@arndb.de>,
 Peter Zijlstra <peterz@infradead.org>, Anup Patel <anup@brainfault.org>,
 linux-kernel@vger.kernel.org, linux-csky@vger.kernel.org,
 openrisc@lists.librecores.org, sparclinux@vger.kernel.org,
 linux-riscv@lists.infradead.org, linuxppc-dev@lists.ozlabs.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

RnJvbTogR3VvIFJlbiA8Z3VvcmVuQGxpbnV4LmFsaWJhYmEuY29tPgoKVGhpcyBwYXRjaCBpbnRy
b2R1Y2VzIGEgdGlja2V0IGxvY2sgaW1wbGVtZW50YXRpb24gZm9yIHJpc2N2LCBhbG9uZyB0aGUK
c2FtZSBsaW5lcyBhcyB0aGUgaW1wbGVtZW50YXRpb24gZm9yIGFyY2gvYXJtICYgYXJjaC9jc2t5
LgoKV2Ugc3RpbGwgdXNlIHFzcGlubG9jayBhcyBkZWZhdWx0LgoKU2lnbmVkLW9mZi1ieTogR3Vv
IFJlbiA8Z3VvcmVuQGxpbnV4LmFsaWJhYmEuY29tPgpDYzogUGV0ZXIgWmlqbHN0cmEgPHBldGVy
ekBpbmZyYWRlYWQub3JnPgpDYzogQW51cCBQYXRlbCA8YW51cEBicmFpbmZhdWx0Lm9yZz4KQ2M6
IEFybmQgQmVyZ21hbm4gPGFybmRAYXJuZGIuZGU+Ci0tLQogYXJjaC9yaXNjdi9LY29uZmlnICAg
ICAgICAgICAgICAgICAgICAgIHwgIDcgKystCiBhcmNoL3Jpc2N2L2luY2x1ZGUvYXNtL3NwaW5s
b2NrLmggICAgICAgfCA4NCArKysrKysrKysrKysrKysrKysrKysrKysrCiBhcmNoL3Jpc2N2L2lu
Y2x1ZGUvYXNtL3NwaW5sb2NrX3R5cGVzLmggfCAxNyArKysrKwogMyBmaWxlcyBjaGFuZ2VkLCAx
MDcgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2FyY2gvcmlzY3Yv
S2NvbmZpZyBiL2FyY2gvcmlzY3YvS2NvbmZpZwppbmRleCA2N2NjNjViYTFlYTEuLjM0ZDAyNzZm
MDFkNSAxMDA2NDQKLS0tIGEvYXJjaC9yaXNjdi9LY29uZmlnCisrKyBiL2FyY2gvcmlzY3YvS2Nv
bmZpZwpAQCAtMzQsNyArMzQsNyBAQCBjb25maWcgUklTQ1YKIAlzZWxlY3QgQVJDSF9XQU5UX0ZS
QU1FX1BPSU5URVJTCiAJc2VsZWN0IEFSQ0hfV0FOVF9IVUdFX1BNRF9TSEFSRSBpZiA2NEJJVAog
CXNlbGVjdCBBUkNIX1VTRV9RVUVVRURfUldMT0NLUwotCXNlbGVjdCBBUkNIX1VTRV9RVUVVRURf
U1BJTkxPQ0tTCisJc2VsZWN0IEFSQ0hfVVNFX1FVRVVFRF9TUElOTE9DS1MJaWYgIVJJU0NWX1RJ
Q0tFVF9MT0NLCiAJc2VsZWN0IEFSQ0hfVVNFX1FVRVVFRF9TUElOTE9DS1NfWENIRzMyCiAJc2Vs
ZWN0IENMT05FX0JBQ0tXQVJEUwogCXNlbGVjdCBDTElOVF9USU1FUiBpZiAhTU1VCkBAIC0zNDQs
NiArMzQ0LDExIEBAIGNvbmZpZyBORUVEX1BFUl9DUFVfRU1CRURfRklSU1RfQ0hVTksKIAlkZWZf
Ym9vbCB5CiAJZGVwZW5kcyBvbiBOVU1BCiAKK2NvbmZpZyBSSVNDVl9USUNLRVRfTE9DSworCWJv
b2wgIlRpY2tldC1iYXNlZCBzcGluLWxvY2tpbmciCisJaGVscAorCSAgU2F5IFkgaGVyZSB0byB1
c2UgdGlja2V0LWJhc2VkIHNwaW4tbG9ja2luZy4KKwogY29uZmlnIFJJU0NWX0lTQV9DCiAJYm9v
bCAiRW1pdCBjb21wcmVzc2VkIGluc3RydWN0aW9ucyB3aGVuIGJ1aWxkaW5nIExpbnV4IgogCWRl
ZmF1bHQgeQpkaWZmIC0tZ2l0IGEvYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9jay5oIGIv
YXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9jay5oCmluZGV4IGE1NTdkZTY3YTQyNS4uOTBi
N2VhYTk1MGNmIDEwMDY0NAotLS0gYS9hcmNoL3Jpc2N2L2luY2x1ZGUvYXNtL3NwaW5sb2NrLmgK
KysrIGIvYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9jay5oCkBAIC03LDcgKzcsOTEgQEAK
ICNpZm5kZWYgX0FTTV9SSVNDVl9TUElOTE9DS19ICiAjZGVmaW5lIF9BU01fUklTQ1ZfU1BJTkxP
Q0tfSAogCisjaWZkZWYgQ09ORklHX1JJU0NWX1RJQ0tFVF9MT0NLCisjaWZkZWYgQ09ORklHXzMy
QklUCisjZGVmaW5lIF9fQVNNX1NMTElXICJzbGxpXHQiCisjZGVmaW5lIF9fQVNNX1NSTElXICJz
cmxpXHQiCisjZWxzZQorI2RlZmluZSBfX0FTTV9TTExJVyAic2xsaXdcdCIKKyNkZWZpbmUgX19B
U01fU1JMSVcgInNybGl3XHQiCisjZW5kaWYKKworLyoKKyAqIFRpY2tldC1iYXNlZCBzcGluLWxv
Y2tpbmcuCisgKi8KK3N0YXRpYyBpbmxpbmUgdm9pZCBhcmNoX3NwaW5fbG9jayhhcmNoX3NwaW5s
b2NrX3QgKmxvY2spCit7CisJYXJjaF9zcGlubG9ja190IGxvY2t2YWw7CisJdTMyIHRtcDsKKwor
CWFzbSB2b2xhdGlsZSAoCisJCSIxOglsci53CSUwLCAlMgkJXG4iCisJCSIJbXYJJTEsICUwCQlc
biIKKwkJIglhZGR3CSUwLCAlMCwgJTMJXG4iCisJCSIJc2MudwklMCwgJTAsICUyCVxuIgorCQki
CWJuZXoJJTAsIDFiCQlcbiIKKwkJOiAiPSZyIiAodG1wKSwgIj0mciIgKGxvY2t2YWwpLCAiK0Ei
IChsb2NrLT5sb2NrKQorCQk6ICJyIiAoMSA8PCBUSUNLRVRfTkVYVCkKKwkJOiAibWVtb3J5Iik7
CisKKwlzbXBfY29uZF9sb2FkX2FjcXVpcmUoJmxvY2stPnRpY2tldHMub3duZXIsCisJCQkJCVZB
TCA9PSBsb2NrdmFsLnRpY2tldHMubmV4dCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50IGFyY2hf
c3Bpbl90cnlsb2NrKGFyY2hfc3BpbmxvY2tfdCAqbG9jaykKK3sKKwl1MzIgdG1wLCBjb250ZW5k
ZWQsIHJlczsKKworCWRvIHsKKwkJYXNtIHZvbGF0aWxlICgKKwkJIglsci53CSUwLCAlMwkJXG4i
CisJCV9fQVNNX1NSTElXICAgICIlMSwgJTAsICU1CVxuIgorCQlfX0FTTV9TTExJVyAgICAiJTIs
ICUwLCAlNQlcbiIKKwkJIglvcgklMSwgJTIsICUxCVxuIgorCQkiCWxpCSUyLCAwCQlcbiIKKwkJ
IglzdWIJJTEsICUxLCAlMAlcbiIKKwkJIglibmV6CSUxLCAxZgkJXG4iCisJCSIJYWRkdwklMCwg
JTAsICU0CVxuIgorCQkiCXNjLncJJTIsICUwLCAlMwlcbiIKKwkJIjE6CQkJCVxuIgorCQk6ICI9
JnIiICh0bXApLCAiPSZyIiAoY29udGVuZGVkKSwgIj0mciIgKHJlcyksCisJCSAgIitBIiAobG9j
ay0+bG9jaykKKwkJOiAiciIgKDEgPDwgVElDS0VUX05FWFQpLCAiSSIgKFRJQ0tFVF9ORVhUKQor
CQk6ICJtZW1vcnkiKTsKKwl9IHdoaWxlIChyZXMpOworCisJaWYgKCFjb250ZW5kZWQpCisJCV9f
YXRvbWljX2FjcXVpcmVfZmVuY2UoKTsKKworCXJldHVybiAhY29udGVuZGVkOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQgYXJjaF9zcGluX3VubG9jayhhcmNoX3NwaW5sb2NrX3QgKmxvY2spCit7
CisJc21wX3N0b3JlX3JlbGVhc2UoJmxvY2stPnRpY2tldHMub3duZXIsIGxvY2stPnRpY2tldHMu
b3duZXIgKyAxKTsKK30KKworc3RhdGljIGlubGluZSBpbnQgYXJjaF9zcGluX3ZhbHVlX3VubG9j
a2VkKGFyY2hfc3BpbmxvY2tfdCBsb2NrKQoreworCXJldHVybiBsb2NrLnRpY2tldHMub3duZXIg
PT0gbG9jay50aWNrZXRzLm5leHQ7Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50IGFyY2hfc3Bpbl9p
c19sb2NrZWQoYXJjaF9zcGlubG9ja190ICpsb2NrKQoreworCXJldHVybiAhYXJjaF9zcGluX3Zh
bHVlX3VubG9ja2VkKFJFQURfT05DRSgqbG9jaykpOworfQorCitzdGF0aWMgaW5saW5lIGludCBh
cmNoX3NwaW5faXNfY29udGVuZGVkKGFyY2hfc3BpbmxvY2tfdCAqbG9jaykKK3sKKwlzdHJ1Y3Qg
X19yYXdfdGlja2V0cyB0aWNrZXRzID0gUkVBRF9PTkNFKGxvY2stPnRpY2tldHMpOworCisJcmV0
dXJuICh0aWNrZXRzLm5leHQgLSB0aWNrZXRzLm93bmVyKSA+IDE7Cit9CisjZGVmaW5lIGFyY2hf
c3Bpbl9pc19jb250ZW5kZWQJYXJjaF9zcGluX2lzX2NvbnRlbmRlZAorI2Vsc2UgLyogQ09ORklH
X1JJU0NWX1RJQ0tFVF9MT0NLICovCiAjaW5jbHVkZSA8YXNtL3FzcGlubG9jay5oPgorI2VuZGlm
IC8qIENPTkZJR19SSVNDVl9USUNLRVRfTE9DSyAqLworCiAjaW5jbHVkZSA8YXNtL3Fyd2xvY2su
aD4KIAogI2VuZGlmIC8qIF9BU01fUklTQ1ZfU1BJTkxPQ0tfSCAqLwpkaWZmIC0tZ2l0IGEvYXJj
aC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9ja190eXBlcy5oIGIvYXJjaC9yaXNjdi9pbmNsdWRl
L2FzbS9zcGlubG9ja190eXBlcy5oCmluZGV4IGQwMzNhOTczZjI4Ny4uYWZiYjE5ODQxZDBmIDEw
MDY0NAotLS0gYS9hcmNoL3Jpc2N2L2luY2x1ZGUvYXNtL3NwaW5sb2NrX3R5cGVzLmgKKysrIGIv
YXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9ja190eXBlcy5oCkBAIC0xMCw3ICsxMCwyNCBA
QAogIyBlcnJvciAicGxlYXNlIGRvbid0IGluY2x1ZGUgdGhpcyBmaWxlIGRpcmVjdGx5IgogI2Vu
ZGlmCiAKKyNpZmRlZiBDT05GSUdfUklTQ1ZfVElDS0VUX0xPQ0sKKyNkZWZpbmUgVElDS0VUX05F
WFQJMTYKKwordHlwZWRlZiBzdHJ1Y3QgeworCXVuaW9uIHsKKwkJdTMyIGxvY2s7CisJCXN0cnVj
dCBfX3Jhd190aWNrZXRzIHsKKwkJCS8qIGxpdHRsZSBlbmRpYW4gKi8KKwkJCXUxNiBvd25lcjsK
KwkJCXUxNiBuZXh0OworCQl9IHRpY2tldHM7CisJfTsKK30gYXJjaF9zcGlubG9ja190OworCisj
ZGVmaW5lIF9fQVJDSF9TUElOX0xPQ0tfVU5MT0NLRUQJeyB7IDAgfSB9CisjZWxzZQogI2luY2x1
ZGUgPGFzbS1nZW5lcmljL3FzcGlubG9ja190eXBlcy5oPgorI2VuZGlmCiAjaW5jbHVkZSA8YXNt
LWdlbmVyaWMvcXJ3bG9ja190eXBlcy5oPgogCiAjZW5kaWYgLyogX0FTTV9SSVNDVl9TUElOTE9D
S19UWVBFU19IICovCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCk9wZW5SSVNDIG1haWxpbmcgbGlzdApPcGVuUklTQ0BsaXN0cy5saWJy
ZWNvcmVzLm9yZwpodHRwczovL2xpc3RzLmxpYnJlY29yZXMub3JnL2xpc3RpbmZvL29wZW5yaXNj
Cg==
