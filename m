Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id B9BE934BF30
	for <lists+openrisc@lfdr.de>; Sun, 28 Mar 2021 23:14:56 +0200 (CEST)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 6F7C9212C4;
	Sun, 28 Mar 2021 23:14:53 +0200 (CEST)
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by mail.librecores.org (Postfix) with ESMTPS id 10EE421247
 for <openrisc@lists.librecores.org>; Sun, 28 Mar 2021 08:31:26 +0200 (CEST)
Received: by mail.kernel.org (Postfix) with ESMTPSA id 2B9A76198F;
 Sun, 28 Mar 2021 06:31:20 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1616913084;
 bh=RHIlCNf2j+Ok+QoigsRs+Vcz1qgiomFS7YnCplj9JuE=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=A0adv1QSOjJetRSxFJOCIhqf786u8FpE9GL+suXuO7xAirjxM0RoLpgzIbWh2WAj5
 uj7H1dDw8/ZjNARTmCR+P8rd5Iq6ScTBSMh8mVeEbbG/tKV2sS188Ds9+/xobj8cUC
 EibrcghgWbPSsA+uIgUohyqc3ejFXck2oTwUzJcysxFMiEzIezMlG5EHaUdQm8bN3P
 G0dLchaLk0h9/WWWjZGIhg0BGaVdgb/5FdjmHa9Zbm9XOGJ7zqG9MlL/BfAbNqBW/N
 vfXwm+7+XgrunPvivrLA4LkMUMh4p0YIbP24um+x1fk8I5nX6bTgJTVheiGpmMVqg8
 wAN+Vnc39IEiQ==
From: guoren@kernel.org
To: guoren@kernel.org
Date: Sun, 28 Mar 2021 06:30:23 +0000
Message-Id: <1616913028-83376-3-git-send-email-guoren@kernel.org>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1616913028-83376-1-git-send-email-guoren@kernel.org>
References: <1616913028-83376-1-git-send-email-guoren@kernel.org>
X-Mailman-Approved-At: Sun, 28 Mar 2021 23:14:51 +0200
Subject: [OpenRISC] [PATCH v5 2/7] riscv: Convert custom spinlock/rwlock to
 generic qspinlock/qrwlock
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: linux-arch@vger.kernel.org, linux-xtensa@linux-xtensa.org,
 Guo Ren <guoren@linux.alibaba.com>, Arnd Bergmann <arnd@arndb.de>,
 Peter Zijlstra <peterz@infradead.org>, Anup Patel <anup@brainfault.org>,
 Palmer Dabbelt <palmerdabbelt@google.com>, linux-kernel@vger.kernel.org,
 linux-csky@vger.kernel.org, Michael Clark <michaeljclark@mac.com>,
 openrisc@lists.librecores.org, sparclinux@vger.kernel.org,
 linux-riscv@lists.infradead.org, linuxppc-dev@lists.ozlabs.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

RnJvbTogTWljaGFlbCBDbGFyayA8bWljaGFlbGpjbGFya0BtYWMuY29tPgoKVXBkYXRlIHRoZSBS
SVNDLVYgcG9ydCB0byB1c2UgdGhlIGdlbmVyaWMgcXNwaW5sb2NrIGFuZCBxcndsb2NrLgoKVGhp
cyBwYXRjaCByZXF1aXJlcyBzdXBwb3J0IGZvciB4Y2hnX3h0YWlsIGZvciBmdWxsLXdvcmQgd2hp
Y2gKYXJlIGFkZGVkIGJ5IGEgcHJldmlvdXMgcGF0Y2g6CgpHdW8gYWRkZWQgc2VsZWN0IEFSQ0hf
VVNFX1FVRVVFRF9TUElOTE9DS1NfWENIRzMyIGluIEtjb25maWcKCkd1byBmaXhlZCB1cCBjb21w
aWxlIGVycm9yIHdoaWNoIG1hZGUgYnkgYmVsb3cgaW5jbHVkZSBzZXF1ZW5jZToKKyNpbmNsdWRl
IDxhc20vcXJ3bG9jay5oPgorI2luY2x1ZGUgPGFzbS9xc3BpbmxvY2suaD4KClNpZ25lZC1vZmYt
Ynk6IE1pY2hhZWwgQ2xhcmsgPG1pY2hhZWxqY2xhcmtAbWFjLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5
OiBHdW8gUmVuIDxndW9yZW5AbGludXguYWxpYmFiYS5jb20+ClRlc3RlZC1ieTogR3VvIFJlbiA8
Z3VvcmVuQGxpbnV4LmFsaWJhYmEuY29tPgpTaWduZWQtb2ZmLWJ5OiBHdW8gUmVuIDxndW9yZW5A
bGludXguYWxpYmFiYS5jb20+Ckxpbms6IGh0dHBzOi8vbG9yZS5rZXJuZWwub3JnL2xpbnV4LXJp
c2N2LzIwMTkwMjExMDQzODI5LjMwMDk2LTMtbWljaGFlbGpjbGFya0BtYWMuY29tLwpDYzogUGV0
ZXIgWmlqbHN0cmEgPHBldGVyekBpbmZyYWRlYWQub3JnPgpDYzogQW51cCBQYXRlbCA8YW51cEBi
cmFpbmZhdWx0Lm9yZz4KQ2M6IEFybmQgQmVyZ21hbm4gPGFybmRAYXJuZGIuZGU+CkNjOiBQYWxt
ZXIgRGFiYmVsdCA8cGFsbWVyZGFiYmVsdEBnb29nbGUuY29tPgotLS0KIGFyY2gvcmlzY3YvS2Nv
bmZpZyAgICAgICAgICAgICAgICAgICAgICB8ICAgMyArCiBhcmNoL3Jpc2N2L2luY2x1ZGUvYXNt
L0tidWlsZCAgICAgICAgICAgfCAgIDMgKwogYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9j
ay5oICAgICAgIHwgMTI2ICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogYXJjaC9yaXNjdi9pbmNs
dWRlL2FzbS9zcGlubG9ja190eXBlcy5oIHwgIDE1ICstLQogNCBmaWxlcyBjaGFuZ2VkLCAxMSBp
bnNlcnRpb25zKCspLCAxMzYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYXJjaC9yaXNjdi9L
Y29uZmlnIGIvYXJjaC9yaXNjdi9LY29uZmlnCmluZGV4IDg3ZDdiNTJmMjc4Zi4uNjdjYzY1YmEx
ZWExIDEwMDY0NAotLS0gYS9hcmNoL3Jpc2N2L0tjb25maWcKKysrIGIvYXJjaC9yaXNjdi9LY29u
ZmlnCkBAIC0zMyw2ICszMyw5IEBAIGNvbmZpZyBSSVNDVgogCXNlbGVjdCBBUkNIX1dBTlRfREVG
QVVMVF9UT1BET1dOX01NQVBfTEFZT1VUIGlmIE1NVQogCXNlbGVjdCBBUkNIX1dBTlRfRlJBTUVf
UE9JTlRFUlMKIAlzZWxlY3QgQVJDSF9XQU5UX0hVR0VfUE1EX1NIQVJFIGlmIDY0QklUCisJc2Vs
ZWN0IEFSQ0hfVVNFX1FVRVVFRF9SV0xPQ0tTCisJc2VsZWN0IEFSQ0hfVVNFX1FVRVVFRF9TUElO
TE9DS1MKKwlzZWxlY3QgQVJDSF9VU0VfUVVFVUVEX1NQSU5MT0NLU19YQ0hHMzIKIAlzZWxlY3Qg
Q0xPTkVfQkFDS1dBUkRTCiAJc2VsZWN0IENMSU5UX1RJTUVSIGlmICFNTVUKIAlzZWxlY3QgQ09N
TU9OX0NMSwpkaWZmIC0tZ2l0IGEvYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9LYnVpbGQgYi9hcmNo
L3Jpc2N2L2luY2x1ZGUvYXNtL0tidWlsZAppbmRleCA0NDVjY2M5NzMwNWEuLjc1MGMxMDU2Yjkw
ZiAxMDA2NDQKLS0tIGEvYXJjaC9yaXNjdi9pbmNsdWRlL2FzbS9LYnVpbGQKKysrIGIvYXJjaC9y
aXNjdi9pbmNsdWRlL2FzbS9LYnVpbGQKQEAgLTMsNSArMyw4IEBAIGdlbmVyaWMteSArPSBlYXJs
eV9pb3JlbWFwLmgKIGdlbmVyaWMteSArPSBleHRhYmxlLmgKIGdlbmVyaWMteSArPSBmbGF0LmgK
IGdlbmVyaWMteSArPSBrdm1fcGFyYS5oCitnZW5lcmljLXkgKz0gbWNzX3NwaW5sb2NrLmgKK2dl
bmVyaWMteSArPSBxcndsb2NrLmgKK2dlbmVyaWMteSArPSBxc3BpbmxvY2suaAogZ2VuZXJpYy15
ICs9IHVzZXIuaAogZ2VuZXJpYy15ICs9IHZtbGludXgubGRzLmgKZGlmZiAtLWdpdCBhL2FyY2gv
cmlzY3YvaW5jbHVkZS9hc20vc3BpbmxvY2suaCBiL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3Bp
bmxvY2suaAppbmRleCBmNGY3ZmExYjdjYTguLmE1NTdkZTY3YTQyNSAxMDA2NDQKLS0tIGEvYXJj
aC9yaXNjdi9pbmNsdWRlL2FzbS9zcGlubG9jay5oCisrKyBiL2FyY2gvcmlzY3YvaW5jbHVkZS9h
c20vc3BpbmxvY2suaApAQCAtNywxMjkgKzcsNyBAQAogI2lmbmRlZiBfQVNNX1JJU0NWX1NQSU5M
T0NLX0gKICNkZWZpbmUgX0FTTV9SSVNDVl9TUElOTE9DS19ICiAKLSNpbmNsdWRlIDxsaW51eC9r
ZXJuZWwuaD4KLSNpbmNsdWRlIDxhc20vY3VycmVudC5oPgotI2luY2x1ZGUgPGFzbS9mZW5jZS5o
PgotCi0vKgotICogU2ltcGxlIHNwaW4gbG9jayBvcGVyYXRpb25zLiAgVGhlc2UgcHJvdmlkZSBu
byBmYWlybmVzcyBndWFyYW50ZWVzLgotICovCi0KLS8qIEZJWE1FOiBSZXBsYWNlIHRoaXMgd2l0
aCBhIHRpY2tldCBsb2NrLCBsaWtlIE1JUFMuICovCi0KLSNkZWZpbmUgYXJjaF9zcGluX2lzX2xv
Y2tlZCh4KQkoUkVBRF9PTkNFKCh4KS0+bG9jaykgIT0gMCkKLQotc3RhdGljIGlubGluZSB2b2lk
IGFyY2hfc3Bpbl91bmxvY2soYXJjaF9zcGlubG9ja190ICpsb2NrKQotewotCXNtcF9zdG9yZV9y
ZWxlYXNlKCZsb2NrLT5sb2NrLCAwKTsKLX0KLQotc3RhdGljIGlubGluZSBpbnQgYXJjaF9zcGlu
X3RyeWxvY2soYXJjaF9zcGlubG9ja190ICpsb2NrKQotewotCWludCB0bXAgPSAxLCBidXN5Owot
Ci0JX19hc21fXyBfX3ZvbGF0aWxlX18gKAotCQkiCWFtb3N3YXAudyAlMCwgJTIsICUxXG4iCi0J
CVJJU0NWX0FDUVVJUkVfQkFSUklFUgotCQk6ICI9ciIgKGJ1c3kpLCAiK0EiIChsb2NrLT5sb2Nr
KQotCQk6ICJyIiAodG1wKQotCQk6ICJtZW1vcnkiKTsKLQotCXJldHVybiAhYnVzeTsKLX0KLQot
c3RhdGljIGlubGluZSB2b2lkIGFyY2hfc3Bpbl9sb2NrKGFyY2hfc3BpbmxvY2tfdCAqbG9jaykK
LXsKLQl3aGlsZSAoMSkgewotCQlpZiAoYXJjaF9zcGluX2lzX2xvY2tlZChsb2NrKSkKLQkJCWNv
bnRpbnVlOwotCi0JCWlmIChhcmNoX3NwaW5fdHJ5bG9jayhsb2NrKSkKLQkJCWJyZWFrOwotCX0K
LX0KLQotLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqLwotCi1zdGF0aWMgaW5saW5lIHZvaWQgYXJjaF9yZWFkX2xvY2soYXJjaF9yd2xv
Y2tfdCAqbG9jaykKLXsKLQlpbnQgdG1wOwotCi0JX19hc21fXyBfX3ZvbGF0aWxlX18oCi0JCSIx
Oglsci53CSUxLCAlMFxuIgotCQkiCWJsdHoJJTEsIDFiXG4iCi0JCSIJYWRkaQklMSwgJTEsIDFc
biIKLQkJIglzYy53CSUxLCAlMSwgJTBcbiIKLQkJIglibmV6CSUxLCAxYlxuIgotCQlSSVNDVl9B
Q1FVSVJFX0JBUlJJRVIKLQkJOiAiK0EiIChsb2NrLT5sb2NrKSwgIj0mciIgKHRtcCkKLQkJOjog
Im1lbW9yeSIpOwotfQotCi1zdGF0aWMgaW5saW5lIHZvaWQgYXJjaF93cml0ZV9sb2NrKGFyY2hf
cndsb2NrX3QgKmxvY2spCi17Ci0JaW50IHRtcDsKLQotCV9fYXNtX18gX192b2xhdGlsZV9fKAot
CQkiMToJbHIudwklMSwgJTBcbiIKLQkJIglibmV6CSUxLCAxYlxuIgotCQkiCWxpCSUxLCAtMVxu
IgotCQkiCXNjLncJJTEsICUxLCAlMFxuIgotCQkiCWJuZXoJJTEsIDFiXG4iCi0JCVJJU0NWX0FD
UVVJUkVfQkFSUklFUgotCQk6ICIrQSIgKGxvY2stPmxvY2spLCAiPSZyIiAodG1wKQotCQk6OiAi
bWVtb3J5Iik7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgaW50IGFyY2hfcmVhZF90cnlsb2NrKGFyY2hf
cndsb2NrX3QgKmxvY2spCi17Ci0JaW50IGJ1c3k7Ci0KLQlfX2FzbV9fIF9fdm9sYXRpbGVfXygK
LQkJIjE6CWxyLncJJTEsICUwXG4iCi0JCSIJYmx0egklMSwgMWZcbiIKLQkJIglhZGRpCSUxLCAl
MSwgMVxuIgotCQkiCXNjLncJJTEsICUxLCAlMFxuIgotCQkiCWJuZXoJJTEsIDFiXG4iCi0JCVJJ
U0NWX0FDUVVJUkVfQkFSUklFUgotCQkiMTpcbiIKLQkJOiAiK0EiIChsb2NrLT5sb2NrKSwgIj0m
ciIgKGJ1c3kpCi0JCTo6ICJtZW1vcnkiKTsKLQotCXJldHVybiAhYnVzeTsKLX0KLQotc3RhdGlj
IGlubGluZSBpbnQgYXJjaF93cml0ZV90cnlsb2NrKGFyY2hfcndsb2NrX3QgKmxvY2spCi17Ci0J
aW50IGJ1c3k7Ci0KLQlfX2FzbV9fIF9fdm9sYXRpbGVfXygKLQkJIjE6CWxyLncJJTEsICUwXG4i
Ci0JCSIJYm5legklMSwgMWZcbiIKLQkJIglsaQklMSwgLTFcbiIKLQkJIglzYy53CSUxLCAlMSwg
JTBcbiIKLQkJIglibmV6CSUxLCAxYlxuIgotCQlSSVNDVl9BQ1FVSVJFX0JBUlJJRVIKLQkJIjE6
XG4iCi0JCTogIitBIiAobG9jay0+bG9jayksICI9JnIiIChidXN5KQotCQk6OiAibWVtb3J5Iik7
Ci0KLQlyZXR1cm4gIWJ1c3k7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdm9pZCBhcmNoX3JlYWRfdW5s
b2NrKGFyY2hfcndsb2NrX3QgKmxvY2spCi17Ci0JX19hc21fXyBfX3ZvbGF0aWxlX18oCi0JCVJJ
U0NWX1JFTEVBU0VfQkFSUklFUgotCQkiCWFtb2FkZC53IHgwLCAlMSwgJTBcbiIKLQkJOiAiK0Ei
IChsb2NrLT5sb2NrKQotCQk6ICJyIiAoLTEpCi0JCTogIm1lbW9yeSIpOwotfQotCi1zdGF0aWMg
aW5saW5lIHZvaWQgYXJjaF93cml0ZV91bmxvY2soYXJjaF9yd2xvY2tfdCAqbG9jaykKLXsKLQlz
bXBfc3RvcmVfcmVsZWFzZSgmbG9jay0+bG9jaywgMCk7Ci19CisjaW5jbHVkZSA8YXNtL3FzcGlu
bG9jay5oPgorI2luY2x1ZGUgPGFzbS9xcndsb2NrLmg+CiAKICNlbmRpZiAvKiBfQVNNX1JJU0NW
X1NQSU5MT0NLX0ggKi8KZGlmZiAtLWdpdCBhL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3Bpbmxv
Y2tfdHlwZXMuaCBiL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3BpbmxvY2tfdHlwZXMuaAppbmRl
eCBmMzk4ZTc2MzhkZDYuLmQwMzNhOTczZjI4NyAxMDA2NDQKLS0tIGEvYXJjaC9yaXNjdi9pbmNs
dWRlL2FzbS9zcGlubG9ja190eXBlcy5oCisrKyBiL2FyY2gvcmlzY3YvaW5jbHVkZS9hc20vc3Bp
bmxvY2tfdHlwZXMuaApAQCAtNiwyMCArNiwxMSBAQAogI2lmbmRlZiBfQVNNX1JJU0NWX1NQSU5M
T0NLX1RZUEVTX0gKICNkZWZpbmUgX0FTTV9SSVNDVl9TUElOTE9DS19UWVBFU19ICiAKLSNpZm5k
ZWYgX19MSU5VWF9TUElOTE9DS19UWVBFU19ICisjaWYgIWRlZmluZWQoX19MSU5VWF9TUElOTE9D
S19UWVBFU19IKSAmJiAhZGVmaW5lZChfQVNNX1JJU0NWX1NQSU5MT0NLX0gpCiAjIGVycm9yICJw
bGVhc2UgZG9uJ3QgaW5jbHVkZSB0aGlzIGZpbGUgZGlyZWN0bHkiCiAjZW5kaWYKIAotdHlwZWRl
ZiBzdHJ1Y3QgewotCXZvbGF0aWxlIHVuc2lnbmVkIGludCBsb2NrOwotfSBhcmNoX3NwaW5sb2Nr
X3Q7Ci0KLSNkZWZpbmUgX19BUkNIX1NQSU5fTE9DS19VTkxPQ0tFRAl7IDAgfQotCi10eXBlZGVm
IHN0cnVjdCB7Ci0Jdm9sYXRpbGUgdW5zaWduZWQgaW50IGxvY2s7Ci19IGFyY2hfcndsb2NrX3Q7
Ci0KLSNkZWZpbmUgX19BUkNIX1JXX0xPQ0tfVU5MT0NLRUQJCXsgMCB9CisjaW5jbHVkZSA8YXNt
LWdlbmVyaWMvcXNwaW5sb2NrX3R5cGVzLmg+CisjaW5jbHVkZSA8YXNtLWdlbmVyaWMvcXJ3bG9j
a190eXBlcy5oPgogCiAjZW5kaWYgLyogX0FTTV9SSVNDVl9TUElOTE9DS19UWVBFU19IICovCi0t
IAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
Ck9wZW5SSVNDIG1haWxpbmcgbGlzdApPcGVuUklTQ0BsaXN0cy5saWJyZWNvcmVzLm9yZwpodHRw
czovL2xpc3RzLmxpYnJlY29yZXMub3JnL2xpc3RpbmZvL29wZW5yaXNjCg==
