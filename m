Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id 4C3CC17175A
	for <lists+openrisc@lfdr.de>; Thu, 27 Feb 2020 13:35:31 +0100 (CET)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 8A6B62069E;
	Thu, 27 Feb 2020 13:35:28 +0100 (CET)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [198.137.202.133])
 by mail.librecores.org (Postfix) with ESMTPS id 0D72C207EE
 for <openrisc@lists.librecores.org>; Thu, 20 Feb 2020 18:01:59 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description;
 bh=Alm0sIO2cKq9nLqFFwjI+EFY1p/t5dmqc+YGFpAjkJQ=; b=mb93pfnK476BqDYmOmly6vw245
 IOzZrn5qT0PEib/xfQgornOINIhoFuEi3yJ9doUw6MTajyu9nFKnRQTaM6DSdzmlCzMck4Bt/FgQ5
 B8Rgk0oUEQ7fHvJGO5d5GNGKKK+Pr+fmNrKPu/R9pyrGSsTL5GL0b/LXjz+ypAP47TJ0U75oMVzr+
 pIf9xFQk0c1mrLP1gsSeQRgPRgMHvz9nmB+gxgM3zX73EncGtdl7ssA8ICfYk0fiKFZ3r3kxHLUG6
 KDnETM2QNUa6dpEUvYCzV7B2Po65exI4yiLurokI3WJdnGxo7PsLfdcqQsRao6vqTZUnwkf5froGu
 gu0gpn6w==;
Received: from [38.126.112.138] (helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92.3 #3 (Red Hat Linux))
 id 1j4pCl-0000Dm-Gx; Thu, 20 Feb 2020 17:01:39 +0000
From: Christoph Hellwig <hch@lst.de>
To: Jonas Bonn <jonas@southpole.se>,
 Stefan Kristiansson <stefan.kristiansson@saunalahti.fi>,
 Stafford Horne <shorne@gmail.com>
Date: Thu, 20 Feb 2020 09:01:38 -0800
Message-Id: <20200220170139.387354-2-hch@lst.de>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200220170139.387354-1-hch@lst.de>
References: <20200220170139.387354-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Approved-At: Thu, 27 Feb 2020 13:35:25 +0100
Subject: [OpenRISC] [PATCH 1/2] dma-mapping: support setting memory uncached
 in place
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>, linux-arch@vger.kernel.org,
 Robin Murphy <robin.murphy@arm.com>, linux-kernel@vger.kernel.org,
 iommu@lists.linux-foundation.org, openrisc@lists.librecores.org,
 Will Deacon <will@kernel.org>, linux-arm-kernel@lists.infradead.org,
 Marek Szyprowski <m.szyprowski@samsung.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

V2UgY3VycmVudGx5IG9ubHkgc3VwcG9ydCByZW1hcHBpbmcgbWVtb3J5IGFzIHVuY2FjaGVkIHRo
cm91Z2ggdm1hcApvciBhIG1hZ2ljIHVuY2FjaGVkIHNlZ21lbnQgcHJvdmlkZWQgYnkgc29tZSBh
cmNoaXRlY3R1cmVzLiAgQnV0IHRoZXJlCmlzIGEgc2ltcGxlciBhbmQgbXVjaCBiZXR0ZXIgd2F5
IGF2YWlsYWJsZSBvbiBzb21lIGFyY2hpdGVjdHVyZXMgd2hlcmUKd2UgY2FuIGp1c3QgcmVtYXAg
dGhlIG1lbW9yeSBpbiBwbGFjZS4gIFRoZSBhZHZhbnRhZ2VzIGFyZToKCiAxKSBubyBhbGlhc2lu
ZyBpcyBwb3NzaWJsZSwgd2hpY2ggcHJldmVudHMgc3BlY3VsYXRpbmcgaW50byB0aGUKICAgIGNh
Y2hlZCBhbGlhcwogMikgdGhlcmUgaXMgbm8gbmVlZCB0byBhbGxvY2F0ZSBuZXcgcHRlcyBhbmQg
dGh1cyBubyBuZWVkIGZvciBhIHNwZWNpYWwKICAgIHByZS1hbGxvY2F0ZWQgcG9vbCBvZiBtZW1v
cnkgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIEdGUF9BVE9NSUMgRE1BCiAgICBhbGxvY2F0aW9ucwoK
VGhlIGRvd25zaWRlIGlzIHRoYXQgYXJjaGl0ZWN0dXJlcyBtdXN0IHByb3ZpZGUgYSB3YXkgdG8g
c2V0IGFyYml0cmFyeQpwYWdlcyB1bmNhY2hlZCBpbiB0aGUga2VybmVsIG1hcHBpbmcsIHdoaWNo
IG1pZ2h0IG5vdCBiZSBwb3NzaWJsZSBvbgphcmNoaXRlY3R1cmUgdGhhdCBoYXZlIGEgc3BlY2lh
bCBpbXBsaWNpdCBrZXJuZWwgbWFwcGluZywgYW5kIHJlcXVpcmVzCnNwbGl0dGluZyBvZiBodWdl
IHBhZ2Uga2VybmVsIG1hcHBpbmdzIHdoZXJlIHRoZXkgZXhpc3QuCgpTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RvcGggSGVsbHdpZyA8aGNoQGxzdC5kZT4KLS0tCiBpbmNsdWRlL2xpbnV4L2RtYS1ub25j
b2hlcmVudC5oIHwgIDMgKysrCiBrZXJuZWwvZG1hL0tjb25maWcgICAgICAgICAgICAgIHwgIDgg
KysrKysrKysKIGtlcm5lbC9kbWEvZGlyZWN0LmMgICAgICAgICAgICAgfCAyOCArKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDI5IGluc2VydGlvbnMoKyksIDEw
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvZG1hLW5vbmNvaGVyZW50
LmggYi9pbmNsdWRlL2xpbnV4L2RtYS1ub25jb2hlcmVudC5oCmluZGV4IGNhOWI1NzcwY2FlZS4u
MDgyMGVjNThmMTE5IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2RtYS1ub25jb2hlcmVudC5o
CisrKyBiL2luY2x1ZGUvbGludXgvZG1hLW5vbmNvaGVyZW50LmgKQEAgLTExMSw0ICsxMTEsNyBA
QCBzdGF0aWMgaW5saW5lIHZvaWQgYXJjaF9kbWFfcHJlcF9jb2hlcmVudChzdHJ1Y3QgcGFnZSAq
cGFnZSwgc2l6ZV90IHNpemUpCiB2b2lkICp1bmNhY2hlZF9rZXJuZWxfYWRkcmVzcyh2b2lkICph
ZGRyKTsKIHZvaWQgKmNhY2hlZF9rZXJuZWxfYWRkcmVzcyh2b2lkICphZGRyKTsKIAoraW50IGFy
Y2hfZG1hX3NldF91bmNhY2hlZCh2b2lkICpjcHVfYWRkciwgc2l6ZV90IHNpemUpOwordm9pZCBh
cmNoX2RtYV9jbGVhcl91bmNhY2hlZCh2b2lkICpjcHVfYWRkciwgc2l6ZV90IHNpemUpOworCiAj
ZW5kaWYgLyogX0xJTlVYX0RNQV9OT05DT0hFUkVOVF9IICovCmRpZmYgLS1naXQgYS9rZXJuZWwv
ZG1hL0tjb25maWcgYi9rZXJuZWwvZG1hL0tjb25maWcKaW5kZXggNGMxMDNhMjRlMzgwLi43YmMw
Yjc3ZjEyNDMgMTAwNjQ0Ci0tLSBhL2tlcm5lbC9kbWEvS2NvbmZpZworKysgYi9rZXJuZWwvZG1h
L0tjb25maWcKQEAgLTgzLDYgKzgzLDE0IEBAIGNvbmZpZyBETUFfRElSRUNUX1JFTUFQCiAJYm9v
bAogCXNlbGVjdCBETUFfUkVNQVAKIAorIworIyBTaG91bGQgYmUgc2VsZWN0ZWQgaWYgdGhlIGFy
Y2hpdGVjdHVyZSBjYW4gcmVtYXAgbWVtb3J5IGZyb20gdGhlIHBhZ2UKKyMgYWxsb2NhdG9yIGFu
ZCBDTUEgYXMgdW5jYWNoZWQgYW5kIHByb3ZpZGVzIHRoZSBhcmNoX2RtYV9zZXRfdW5jYWNoZWQg
YW5kCisjIGFyY2hfZG1hX2NsZWFyX3VuY2FjaGVkIGhlbHBlcnMKKyMKK2NvbmZpZyBBUkNIX0hB
U19ETUFfU0VUX1VOQ0FDSEVECisJYm9vbAorCiBjb25maWcgRE1BX0NNQQogCWJvb2wgIkRNQSBD
b250aWd1b3VzIE1lbW9yeSBBbGxvY2F0b3IiCiAJZGVwZW5kcyBvbiBIQVZFX0RNQV9DT05USUdV
T1VTICYmIENNQQpkaWZmIC0tZ2l0IGEva2VybmVsL2RtYS9kaXJlY3QuYyBiL2tlcm5lbC9kbWEv
ZGlyZWN0LmMKaW5kZXggNmFmN2FlODNjNGFkLi43M2ZlNjVhNGNiYzAgMTAwNjQ0Ci0tLSBhL2tl
cm5lbC9kbWEvZGlyZWN0LmMKKysrIGIva2VybmVsL2RtYS9kaXJlY3QuYwpAQCAtMTY5LDExICsx
NjksOCBAQCB2b2lkICpkbWFfZGlyZWN0X2FsbG9jX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwg
c2l6ZV90IHNpemUsCiAJCXJldCA9IGRtYV9jb21tb25fY29udGlndW91c19yZW1hcChwYWdlLCBQ
QUdFX0FMSUdOKHNpemUpLAogCQkJCWRtYV9wZ3Byb3QoZGV2LCBQQUdFX0tFUk5FTCwgYXR0cnMp
LAogCQkJCV9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7Ci0JCWlmICghcmV0KSB7Ci0JCQlk
bWFfZnJlZV9jb250aWd1b3VzKGRldiwgcGFnZSwgc2l6ZSk7Ci0JCQlyZXR1cm4gcmV0OwotCQl9
Ci0KKwkJaWYgKCFyZXQpCisJCQlnb3RvIG91dF9mcmVlX3BhZ2VzOwogCQltZW1zZXQocmV0LCAw
LCBzaXplKTsKIAkJZ290byBkb25lOwogCX0KQEAgLTE4Niw4ICsxODMsNyBAQCB2b2lkICpkbWFf
ZGlyZWN0X2FsbG9jX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwgc2l6ZV90IHNpemUsCiAJCSAq
IHNvIGxvZyBhbiBlcnJvciBhbmQgZmFpbC4KIAkJICovCiAJCWRldl9pbmZvKGRldiwgIlJlamVj
dGluZyBoaWdobWVtIHBhZ2UgZnJvbSBDTUEuXG4iKTsKLQkJZG1hX2ZyZWVfY29udGlndW91cyhk
ZXYsIHBhZ2UsIHNpemUpOwotCQlyZXR1cm4gTlVMTDsKKwkJZ290byBvdXRfZnJlZV9wYWdlczsK
IAl9CiAKIAlyZXQgPSBwYWdlX2FkZHJlc3MocGFnZSk7CkBAIC0xOTYsMTAgKzE5MiwxNSBAQCB2
b2lkICpkbWFfZGlyZWN0X2FsbG9jX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwgc2l6ZV90IHNp
emUsCiAKIAltZW1zZXQocmV0LCAwLCBzaXplKTsKIAotCWlmIChJU19FTkFCTEVEKENPTkZJR19B
UkNIX0hBU19VTkNBQ0hFRF9TRUdNRU5UKSAmJgotCSAgICBkbWFfYWxsb2NfbmVlZF91bmNhY2hl
ZChkZXYsIGF0dHJzKSkgeworCWlmIChkbWFfYWxsb2NfbmVlZF91bmNhY2hlZChkZXYsIGF0dHJz
KSkgewogCQlhcmNoX2RtYV9wcmVwX2NvaGVyZW50KHBhZ2UsIHNpemUpOwotCQlyZXQgPSB1bmNh
Y2hlZF9rZXJuZWxfYWRkcmVzcyhyZXQpOworCisJCWlmIChJU19FTkFCTEVEKENPTkZJR19BUkNI
X0hBU19ETUFfU0VUX1VOQ0FDSEVEKSkgeworCQkJaWYgKCFhcmNoX2RtYV9zZXRfdW5jYWNoZWQo
cmV0LCBzaXplKSkKKwkJCQlnb3RvIG91dF9mcmVlX3BhZ2VzOworCQl9IGVsc2UgaWYgKElTX0VO
QUJMRUQoQ09ORklHX0FSQ0hfSEFTX1VOQ0FDSEVEX1NFR01FTlQpKSB7CisJCQlyZXQgPSB1bmNh
Y2hlZF9rZXJuZWxfYWRkcmVzcyhyZXQpOworCQl9CiAJfQogZG9uZToKIAlpZiAoZm9yY2VfZG1h
X3VuZW5jcnlwdGVkKGRldikpCkBAIC0yMDcsNiArMjA4LDkgQEAgdm9pZCAqZG1hX2RpcmVjdF9h
bGxvY19wYWdlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHNpemVfdCBzaXplLAogCWVsc2UKIAkJKmRt
YV9oYW5kbGUgPSBwaHlzX3RvX2RtYShkZXYsIHBhZ2VfdG9fcGh5cyhwYWdlKSk7CiAJcmV0dXJu
IHJldDsKK291dF9mcmVlX3BhZ2VzOgorCWRtYV9mcmVlX2NvbnRpZ3VvdXMoZGV2LCBwYWdlLCBz
aXplKTsKKwlyZXR1cm4gTlVMTDsKIH0KIAogdm9pZCBkbWFfZGlyZWN0X2ZyZWVfcGFnZXMoc3Ry
dWN0IGRldmljZSAqZGV2LCBzaXplX3Qgc2l6ZSwgdm9pZCAqY3B1X2FkZHIsCkBAIC0yMzAsNiAr
MjM0LDggQEAgdm9pZCBkbWFfZGlyZWN0X2ZyZWVfcGFnZXMoc3RydWN0IGRldmljZSAqZGV2LCBz
aXplX3Qgc2l6ZSwgdm9pZCAqY3B1X2FkZHIsCiAKIAlpZiAoSVNfRU5BQkxFRChDT05GSUdfRE1B
X1JFTUFQKSAmJiBpc192bWFsbG9jX2FkZHIoY3B1X2FkZHIpKQogCQl2dW5tYXAoY3B1X2FkZHIp
OworCWVsc2UgaWYgKElTX0VOQUJMRUQoQ09ORklHX0FSQ0hfSEFTX0RNQV9TRVRfVU5DQUNIRUQp
KQorCQlhcmNoX2RtYV9jbGVhcl91bmNhY2hlZChjcHVfYWRkciwgc2l6ZSk7CiAKIAlkbWFfZnJl
ZV9jb250aWd1b3VzKGRldiwgZG1hX2RpcmVjdF90b19wYWdlKGRldiwgZG1hX2FkZHIpLCBzaXpl
KTsKIH0KQEAgLTIzOCw2ICsyNDQsNyBAQCB2b2lkICpkbWFfZGlyZWN0X2FsbG9jKHN0cnVjdCBk
ZXZpY2UgKmRldiwgc2l6ZV90IHNpemUsCiAJCWRtYV9hZGRyX3QgKmRtYV9oYW5kbGUsIGdmcF90
IGdmcCwgdW5zaWduZWQgbG9uZyBhdHRycykKIHsKIAlpZiAoIUlTX0VOQUJMRUQoQ09ORklHX0FS
Q0hfSEFTX1VOQ0FDSEVEX1NFR01FTlQpICYmCisJICAgICFJU19FTkFCTEVEKENPTkZJR19BUkNI
X0hBU19ETUFfU0VUX1VOQ0FDSEVEKSAmJgogCSAgICAhSVNfRU5BQkxFRChDT05GSUdfRE1BX0RJ
UkVDVF9SRU1BUCkgJiYKIAkgICAgZG1hX2FsbG9jX25lZWRfdW5jYWNoZWQoZGV2LCBhdHRycykp
CiAJCXJldHVybiBhcmNoX2RtYV9hbGxvYyhkZXYsIHNpemUsIGRtYV9oYW5kbGUsIGdmcCwgYXR0
cnMpOwpAQCAtMjQ4LDYgKzI1NSw3IEBAIHZvaWQgZG1hX2RpcmVjdF9mcmVlKHN0cnVjdCBkZXZp
Y2UgKmRldiwgc2l6ZV90IHNpemUsCiAJCXZvaWQgKmNwdV9hZGRyLCBkbWFfYWRkcl90IGRtYV9h
ZGRyLCB1bnNpZ25lZCBsb25nIGF0dHJzKQogewogCWlmICghSVNfRU5BQkxFRChDT05GSUdfQVJD
SF9IQVNfVU5DQUNIRURfU0VHTUVOVCkgJiYKKwkgICAgIUlTX0VOQUJMRUQoQ09ORklHX0FSQ0hf
SEFTX0RNQV9TRVRfVU5DQUNIRUQpICYmCiAJICAgICFJU19FTkFCTEVEKENPTkZJR19ETUFfRElS
RUNUX1JFTUFQKSAmJgogCSAgICBkbWFfYWxsb2NfbmVlZF91bmNhY2hlZChkZXYsIGF0dHJzKSkK
IAkJYXJjaF9kbWFfZnJlZShkZXYsIHNpemUsIGNwdV9hZGRyLCBkbWFfYWRkciwgYXR0cnMpOwot
LSAKMi4yNC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpPcGVuUklTQyBtYWlsaW5nIGxpc3QKT3BlblJJU0NAbGlzdHMubGlicmVjb3Jlcy5vcmcKaHR0
cHM6Ly9saXN0cy5saWJyZWNvcmVzLm9yZy9saXN0aW5mby9vcGVucmlzYwo=
