Return-Path: <openrisc-bounces@lists.librecores.org>
X-Original-To: lists+openrisc@lfdr.de
Delivered-To: lists+openrisc@lfdr.de
Received: from mail.librecores.org (lists.librecores.org [88.198.125.70])
	by mail.lfdr.de (Postfix) with ESMTP id A2DB955926
	for <lists+openrisc@lfdr.de>; Tue, 25 Jun 2019 22:41:50 +0200 (CEST)
Received: from [172.31.1.100] (localhost.localdomain [127.0.0.1])
	by mail.librecores.org (Postfix) with ESMTP id 841D0202FA;
	Tue, 25 Jun 2019 22:41:50 +0200 (CEST)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [198.137.202.133])
 by mail.librecores.org (Postfix) with ESMTPS id F243320291
 for <openrisc@lists.librecores.org>; Fri, 14 Jun 2019 16:45:19 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=6oT8UJTQXi/1p8Vkkp5X8xwmGurQs1ddz1miIiClqjk=; b=mJaWxF1LU5NE66yogc7K2jE1M/
 ajfoGNhD/vHgJ/uO2a6yGrnarIGQmAne1urocITqlmwPKCKe2hlDmAS5mYlahdFDwlTHEpCkUvZst
 H/0IapTE9o/v3gUJZtcOSKnxWVSlqsRtANoKdrY4+dxqP8cB9X1c+Ds8XzV0nIqb7c0zXEBxA8pgT
 Q0QJQs89LQ6TsbElGVp2107/s1joP7iiwY/LBLoR9E7trvIwigj06pgJxwCloASrzS6n0cw8RPir2
 eVruFf63T1nOouQVzlVGxJTiFciYyfyh+t+IgLGxXQEMNMLk4Fo9aGxmnTOJVy2gf1kdcyN/sCPZe
 77MjzUgw==;
Received: from 213-225-9-13.nat.highway.a1.net ([213.225.9.13] helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hbnRp-00064n-IM; Fri, 14 Jun 2019 14:44:58 +0000
From: Christoph Hellwig <hch@lst.de>
To: Vineet Gupta <vgupta@synopsys.com>
Date: Fri, 14 Jun 2019 16:44:30 +0200
Message-Id: <20190614144431.21760-7-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614144431.21760-1-hch@lst.de>
References: <20190614144431.21760-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Mailman-Approved-At: Tue, 25 Jun 2019 22:41:44 +0200
Subject: [OpenRISC] [PATCH 6/7] dma-direct: handle
 DMA_ATTR_NO_KERNEL_MAPPING in common code
X-BeenThere: openrisc@lists.librecores.org
X-Mailman-Version: 2.1.26
Precedence: list
List-Id: Discussion around the OpenRISC processor
 <openrisc.lists.librecores.org>
List-Unsubscribe: <https://lists.librecores.org/options/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=unsubscribe>
List-Archive: <http://lists.librecores.org/pipermail/openrisc/>
List-Post: <mailto:openrisc@lists.librecores.org>
List-Help: <mailto:openrisc-request@lists.librecores.org?subject=help>
List-Subscribe: <https://lists.librecores.org/listinfo/openrisc>,
 <mailto:openrisc-request@lists.librecores.org?subject=subscribe>
Cc: Jonas Bonn <jonas@southpole.se>, linux-xtensa@linux-xtensa.org,
 Vladimir Murzin <vladimir.murzin@arm.com>, linux-parisc@vger.kernel.org,
 Helge Deller <deller@gmx.de>, linux-kernel@vger.kernel.org,
 iommu@lists.linux-foundation.org, openrisc@lists.librecores.org,
 linux-snps-arc@lists.infradead.org, linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: openrisc-bounces@lists.librecores.org
Sender: "OpenRISC" <openrisc-bounces@lists.librecores.org>

RE1BX0FUVFJfTk9fS0VSTkVMX01BUFBJTkcgaXMgZ2VuZXJhbGx5IGltcGxlbWVudGVkIGJ5IGFs
bG9jYXRpbmcKbm9ybWFsIGNhY2hlYWJsZSBwYWdlcyBvciBDTUEgbWVtb3J5LCBhbmQgdGhlbiBy
ZXR1cm5pbmcgdGhlIHBhZ2UKcG9pbnRlciBhcyB0aGUgb3BhcXVlIGhhbmRsZS4gIExpZnQgdGhh
dCBjb2RlIGZyb20gdGhlIHh0ZW5zYSBhbmQKZ2VuZXJpYyBkbWEgcmVtYXBwaW5nIGltcGxlbWVu
dGF0aW9ucyBpbnRvIHRoZSBnZW5lcmljIGRtYS1kaXJlY3QKY29kZSBzbyB0aGF0IHdlIGRvbid0
IGV2ZW4gY2FsbCBhcmNoX2RtYV9hbGxvYyBmb3IgdGhlc2UgYWxsb2NhdGlvbnMuCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpc3RvcGggSGVsbHdpZyA8aGNoQGxzdC5kZT4KLS0tCiBhcmNoL3h0ZW5zYS9r
ZXJuZWwvcGNpLWRtYS5jICAgIHwgIDggKy0tLS0tLS0KIGluY2x1ZGUvbGludXgvZG1hLW5vbmNv
aGVyZW50LmggfCAgMiArKwoga2VybmVsL2RtYS9kaXJlY3QuYyAgICAgICAgICAgICB8IDE0ICsr
KysrKysrKysrKysrCiBrZXJuZWwvZG1hL3JlbWFwLmMgICAgICAgICAgICAgIHwgMTMgKystLS0t
LS0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAxOSBpbnNlcnRpb25zKCspLCAxOCBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9hcmNoL3h0ZW5zYS9rZXJuZWwvcGNpLWRtYS5jIGIvYXJjaC94dGVu
c2Eva2VybmVsL3BjaS1kbWEuYwppbmRleCA5MTcxYmZmNzZmYzQuLjIwNjc3MTI3N2RmZiAxMDA2
NDQKLS0tIGEvYXJjaC94dGVuc2Eva2VybmVsL3BjaS1kbWEuYworKysgYi9hcmNoL3h0ZW5zYS9r
ZXJuZWwvcGNpLWRtYS5jCkBAIC0xNjcsMTAgKzE2Nyw2IEBAIHZvaWQgKmFyY2hfZG1hX2FsbG9j
KHN0cnVjdCBkZXZpY2UgKmRldiwgc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmhhbmRsZSwKIAog
CSpoYW5kbGUgPSBwaHlzX3RvX2RtYShkZXYsIHBhZ2VfdG9fcGh5cyhwYWdlKSk7CiAKLQlpZiAo
YXR0cnMgJiBETUFfQVRUUl9OT19LRVJORUxfTUFQUElORykgewotCQlyZXR1cm4gcGFnZTsKLQl9
Ci0KICNpZmRlZiBDT05GSUdfTU1VCiAJaWYgKFBhZ2VIaWdoTWVtKHBhZ2UpKSB7CiAJCXZvaWQg
KnA7CkBAIC0xOTYsOSArMTkyLDcgQEAgdm9pZCBhcmNoX2RtYV9mcmVlKHN0cnVjdCBkZXZpY2Ug
KmRldiwgc2l6ZV90IHNpemUsIHZvaWQgKnZhZGRyLAogCXVuc2lnbmVkIGxvbmcgY291bnQgPSBQ
QUdFX0FMSUdOKHNpemUpID4+IFBBR0VfU0hJRlQ7CiAJc3RydWN0IHBhZ2UgKnBhZ2U7CiAKLQlp
ZiAoYXR0cnMgJiBETUFfQVRUUl9OT19LRVJORUxfTUFQUElORykgewotCQlwYWdlID0gdmFkZHI7
Ci0JfSBlbHNlIGlmIChwbGF0Zm9ybV92YWRkcl91bmNhY2hlZCh2YWRkcikpIHsKKwlpZiAocGxh
dGZvcm1fdmFkZHJfdW5jYWNoZWQodmFkZHIpKSB7CiAJCXBhZ2UgPSB2aXJ0X3RvX3BhZ2UocGxh
dGZvcm1fdmFkZHJfdG9fY2FjaGVkKHZhZGRyKSk7CiAJfSBlbHNlIHsKICNpZmRlZiBDT05GSUdf
TU1VCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1ub25jb2hlcmVudC5oIGIvaW5jbHVk
ZS9saW51eC9kbWEtbm9uY29oZXJlbnQuaAppbmRleCA3MzI5MTlhYzVjMTEuLjUzZWUzNmVjZGYz
NyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9kbWEtbm9uY29oZXJlbnQuaAorKysgYi9pbmNs
dWRlL2xpbnV4L2RtYS1ub25jb2hlcmVudC5oCkBAIC0yOCw2ICsyOCw4IEBAIHN0YXRpYyBpbmxp
bmUgYm9vbCBkbWFfYWxsb2NfbmVlZF91bmNhY2hlZChzdHJ1Y3QgZGV2aWNlICpkZXYsCiB7CiAJ
aWYgKGRldl9pc19kbWFfY29oZXJlbnQoZGV2KSkKIAkJcmV0dXJuIGZhbHNlOworCWlmIChhdHRy
cyAmIERNQV9BVFRSX05PX0tFUk5FTF9NQVBQSU5HKQorCQlyZXR1cm4gZmFsc2U7CiAJaWYgKElT
X0VOQUJMRUQoQ09ORklHX0RNQV9OT05DT0hFUkVOVF9DQUNIRV9TWU5DKSAmJgogCSAgICAoYXR0
cnMgJiBETUFfQVRUUl9OT05fQ09OU0lTVEVOVCkpCiAJCXJldHVybiBmYWxzZTsKZGlmZiAtLWdp
dCBhL2tlcm5lbC9kbWEvZGlyZWN0LmMgYi9rZXJuZWwvZG1hL2RpcmVjdC5jCmluZGV4IGZjMzU0
ZjRmNDkwYi4uYjkwZTFhZWRlNzQzIDEwMDY0NAotLS0gYS9rZXJuZWwvZG1hL2RpcmVjdC5jCisr
KyBiL2tlcm5lbC9kbWEvZGlyZWN0LmMKQEAgLTEzOCw2ICsxMzgsMTQgQEAgdm9pZCAqZG1hX2Rp
cmVjdF9hbGxvY19wYWdlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHNpemVfdCBzaXplLAogCWlmICgh
cGFnZSkKIAkJcmV0dXJuIE5VTEw7CiAKKwlpZiAoYXR0cnMgJiBETUFfQVRUUl9OT19LRVJORUxf
TUFQUElORykgeworCQkvKiByZW1vdmUgYW55IGRpcnR5IGNhY2hlIGxpbmVzIG9uIHRoZSBrZXJu
ZWwgYWxpYXMgKi8KKwkJaWYgKCFQYWdlSGlnaE1lbShwYWdlKSkKKwkJCWFyY2hfZG1hX3ByZXBf
Y29oZXJlbnQocGFnZSwgc2l6ZSk7CisJCS8qIHJldHVybiB0aGUgcGFnZSBwb2ludGVyIGFzIHRo
ZSBvcGFxdWUgY29va2llICovCisJCXJldHVybiBwYWdlOworCX0KKwogCWlmIChQYWdlSGlnaE1l
bShwYWdlKSkgewogCQkvKgogCQkgKiBEZXBlbmRpbmcgb24gdGhlIGNtYT0gYXJndW1lbnRzIGFu
ZCBwZXItYXJjaCBzZXR1cApAQCAtMTc4LDYgKzE4NiwxMiBAQCB2b2lkIGRtYV9kaXJlY3RfZnJl
ZV9wYWdlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHNpemVfdCBzaXplLCB2b2lkICpjcHVfYWRkciwK
IHsKIAl1bnNpZ25lZCBpbnQgcGFnZV9vcmRlciA9IGdldF9vcmRlcihzaXplKTsKIAorCWlmIChh
dHRycyAmIERNQV9BVFRSX05PX0tFUk5FTF9NQVBQSU5HKSB7CisJCS8qIGNwdV9hZGRyIGlzIGEg
c3RydWN0IHBhZ2UgY29va2llLCBub3QgYSBrZXJuZWwgYWRkcmVzcyAqLworCQlfX2RtYV9kaXJl
Y3RfZnJlZV9wYWdlcyhkZXYsIHNpemUsIGNwdV9hZGRyKTsKKwkJcmV0dXJuOworCX0KKwogCWlm
IChmb3JjZV9kbWFfdW5lbmNyeXB0ZWQoKSkKIAkJc2V0X21lbW9yeV9lbmNyeXB0ZWQoKHVuc2ln
bmVkIGxvbmcpY3B1X2FkZHIsIDEgPDwgcGFnZV9vcmRlcik7CiAKZGlmZiAtLWdpdCBhL2tlcm5l
bC9kbWEvcmVtYXAuYyBiL2tlcm5lbC9kbWEvcmVtYXAuYwppbmRleCAwMjA3ZTM3NjRkNTIuLmE1
OTRhZWMwNzg4MiAxMDA2NDQKLS0tIGEva2VybmVsL2RtYS9yZW1hcC5jCisrKyBiL2tlcm5lbC9k
bWEvcmVtYXAuYwpAQCAtMjAyLDggKzIwMiw3IEBAIHZvaWQgKmFyY2hfZG1hX2FsbG9jKHN0cnVj
dCBkZXZpY2UgKmRldiwgc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRtYV9oYW5kbGUsCiAKIAlz
aXplID0gUEFHRV9BTElHTihzaXplKTsKIAotCWlmICghZ2ZwZmxhZ3NfYWxsb3dfYmxvY2tpbmco
ZmxhZ3MpICYmCi0JICAgICEoYXR0cnMgJiBETUFfQVRUUl9OT19LRVJORUxfTUFQUElORykpIHsK
KwlpZiAoIWdmcGZsYWdzX2FsbG93X2Jsb2NraW5nKGZsYWdzKSkgewogCQlyZXQgPSBkbWFfYWxs
b2NfZnJvbV9wb29sKHNpemUsICZwYWdlLCBmbGFncyk7CiAJCWlmICghcmV0KQogCQkJcmV0dXJu
IE5VTEw7CkBAIC0yMTcsMTEgKzIxNiw2IEBAIHZvaWQgKmFyY2hfZG1hX2FsbG9jKHN0cnVjdCBk
ZXZpY2UgKmRldiwgc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRtYV9oYW5kbGUsCiAJLyogcmVt
b3ZlIGFueSBkaXJ0eSBjYWNoZSBsaW5lcyBvbiB0aGUga2VybmVsIGFsaWFzICovCiAJYXJjaF9k
bWFfcHJlcF9jb2hlcmVudChwYWdlLCBzaXplKTsKIAotCWlmIChhdHRycyAmIERNQV9BVFRSX05P
X0tFUk5FTF9NQVBQSU5HKSB7Ci0JCXJldCA9IHBhZ2U7IC8qIG9wYXF1ZSBjb29raWUgKi8KLQkJ
Z290byBkb25lOwotCX0KLQogCS8qIGNyZWF0ZSBhIGNvaGVyZW50IG1hcHBpbmcgKi8KIAlyZXQg
PSBkbWFfY29tbW9uX2NvbnRpZ3VvdXNfcmVtYXAocGFnZSwgc2l6ZSwgVk1fVVNFUk1BUCwKIAkJ
CWFyY2hfZG1hX21tYXBfcGdwcm90KGRldiwgUEFHRV9LRVJORUwsIGF0dHJzKSwKQEAgLTI0MCwx
MCArMjM0LDcgQEAgdm9pZCAqYXJjaF9kbWFfYWxsb2Moc3RydWN0IGRldmljZSAqZGV2LCBzaXpl
X3Qgc2l6ZSwgZG1hX2FkZHJfdCAqZG1hX2hhbmRsZSwKIHZvaWQgYXJjaF9kbWFfZnJlZShzdHJ1
Y3QgZGV2aWNlICpkZXYsIHNpemVfdCBzaXplLCB2b2lkICp2YWRkciwKIAkJZG1hX2FkZHJfdCBk
bWFfaGFuZGxlLCB1bnNpZ25lZCBsb25nIGF0dHJzKQogewotCWlmIChhdHRycyAmIERNQV9BVFRS
X05PX0tFUk5FTF9NQVBQSU5HKSB7Ci0JCS8qIHZhZGRyIGlzIGEgc3RydWN0IHBhZ2UgY29va2ll
LCBub3QgYSBrZXJuZWwgYWRkcmVzcyAqLwotCQlfX2RtYV9kaXJlY3RfZnJlZV9wYWdlcyhkZXYs
IHNpemUsIHZhZGRyKTsKLQl9IGVsc2UgaWYgKCFkbWFfZnJlZV9mcm9tX3Bvb2wodmFkZHIsIFBB
R0VfQUxJR04oc2l6ZSkpKSB7CisJaWYgKCFkbWFfZnJlZV9mcm9tX3Bvb2wodmFkZHIsIFBBR0Vf
QUxJR04oc2l6ZSkpKSB7CiAJCXBoeXNfYWRkcl90IHBoeXMgPSBkbWFfdG9fcGh5cyhkZXYsIGRt
YV9oYW5kbGUpOwogCQlzdHJ1Y3QgcGFnZSAqcGFnZSA9IHBmbl90b19wYWdlKF9fcGh5c190b19w
Zm4ocGh5cykpOwogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCk9wZW5SSVNDIG1haWxpbmcgbGlzdApPcGVuUklTQ0BsaXN0cy5saWJy
ZWNvcmVzLm9yZwpodHRwczovL2xpc3RzLmxpYnJlY29yZXMub3JnL2xpc3RpbmZvL29wZW5yaXNj
Cg==
